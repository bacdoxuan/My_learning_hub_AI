<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MySQL Cheat Sheet #6 - Advanced Administration</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
      color: #fff;
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: linear-gradient(135deg, #0f2027 0%, #203a43 100%);
      border-radius: 15px;
    }
    .header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      color: #fff;
    }
    .header .subtitle {
      color: #fff;
      font-size: 1.1em;
      opacity: 0.9;
    }
    .badge {
      display: inline-block;
      background: rgba(0,0,0,0.3);
      color: #fff;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.85em;
      margin-top: 10px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    .card {
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(52,152,219,0.3);
    }
    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #3498db;
    }
    .card-icon {
      font-size: 1.8em;
      margin-right: 12px;
    }
    .card-title {
      font-size: 1.3em;
      color: #3498db;
    }
    .code-block {
      background: #0d1117;
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.85em;
      overflow-x: auto;
      border-left: 3px solid #3498db;
    }
    .code-comment {
      color: #6a737d;
    }
    .code-keyword {
      color: #ff7b72;
    }
    .code-string {
      color: #a5d6ff;
    }
    .code-method {
      color: #d2a8ff;
    }
    .code-number {
      color: #79c0ff;
    }
    .code-prop {
      color: #7ee787;
    }
    .highlight {
      background: linear-gradient(135deg, rgba(15,32,39,0.2), rgba(52,152,219,0.2));
      padding: 15px;
      border-radius: 10px;
      margin: 10px 0;
    }
    .list-item {
      padding: 8px 0;
      padding-left: 20px;
      position: relative;
    }
    .list-item::before {
      content: "‚ñ∏";
      position: absolute;
      left: 0;
      color: #3498db;
    }
    .tag {
      display: inline-block;
      background: rgba(52,152,219,0.2);
      color: #3498db;
      padding: 3px 10px;
      border-radius: 5px;
      font-size: 0.8em;
      margin: 2px;
    }
    .tag-orange {
      background: rgba(243,156,18,0.2);
      color: #f39c12;
    }
    .tag-red {
      background: rgba(231,76,60,0.2);
      color: #e74c3c;
    }
    .tag-green {
      background: rgba(46,204,113,0.2);
      color: #2ecc71;
    }
    .tag-purple {
      background: rgba(155,89,182,0.2);
      color: #9b59b6;
    }
    .full-width {
      grid-column: 1 / -1;
    }
    .info-box {
      background: rgba(52,152,219,0.1);
      border-left: 3px solid #3498db;
      padding: 12px;
      border-radius: 0 8px 8px 0;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .warning-box {
      background: rgba(231,76,60,0.1);
      border-left: 3px solid #e74c3c;
      padding: 12px;
      border-radius: 0 8px 8px 0;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .tip-box {
      background: rgba(46,204,113,0.1);
      border-left: 3px solid #2ecc71;
      padding: 12px;
      border-radius: 0 8px 8px 0;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .section-title {
      color: #3498db;
      font-size: 1.1em;
      margin: 15px 0 10px 0;
      padding-bottom: 5px;
      border-bottom: 1px dashed rgba(52,152,219,0.3);
    }
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .comparison-table th, .comparison-table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .comparison-table th {
      background: rgba(52,152,219,0.2);
      color: #3498db;
    }
    .comparison-table tr:hover {
      background: rgba(255,255,255,0.05);
    }
    .flex-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 0;
    }
    .footer {
      text-align: center;
      padding: 20px;
      color: rgba(255,255,255,0.5);
      font-size: 0.9em;
    }
    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    @media (max-width: 768px) {
      .two-col {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üõ†Ô∏è MySQL Cheat Sheet #6</h1>
      <div class="subtitle">Advanced Administration ‚Äî Transactions, Concurrency, Replication, Backup</div>
      <div class="badge">üîí Transactions ‚Ä¢ Replication ‚Ä¢ Backup ‚Ä¢ HA</div>
    </div>

    <!-- ACID Transactions -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üîí</span>
          <span class="card-title">ACID Transactions</span>
        </div>
        
        <div class="highlight">
          <strong>ACID Properties:</strong><br>
          ‚Ä¢ <strong>Atomicity:</strong> All operations succeed or fail together<br>
          ‚Ä¢ <strong>Consistency:</strong> Database remains in valid state<br>
          ‚Ä¢ <strong>Isolation:</strong> Concurrent transactions don't interfere<br>
          ‚Ä¢ <strong>Durability:</strong> Committed changes persist
        </div>

        <div class="code-block">
          <span class="code-comment">-- Basic transaction</span>
          <span class="code-keyword">START TRANSACTION</span>;
          
          <span class="code-keyword">BEGIN</span>;
            <span class="code-keyword">UPDATE</span> accounts <span class="code-keyword">SET</span> balance = balance - <span class="code-number">100</span> <span class="code-keyword">WHERE</span> account_id = <span class="code-number">1</span>;
            <span class="code-keyword">UPDATE</span> accounts <span class="code-keyword">SET</span> balance = balance + <span class="code-number">100</span> <span class="code-keyword">WHERE</span> account_id = <span class="code-number">2</span>;
          <span class="code-keyword">COMMIT</span>;  <span class="code-comment">-- All changes saved</span>
          <span class="code-comment">-- OR</span>
          <span class="code-keyword">ROLLBACK</span>;  <span class="code-comment">-- All changes undone</span>
        </div>

        <div class="section-title">SAVEPOINT for Partial Rollback</div>
        <div class="code-block">
          <span class="code-keyword">START TRANSACTION</span>;
            <span class="code-keyword">INSERT INTO</span> orders (customer_id, total_amount) <span class="code-keyword">VALUES</span> (<span class="code-number">5</span>, <span class="code-number">1000</span>);
            <span class="code-keyword">SET</span> @order_id = <span class="code-keyword">LAST_INSERT_ID</span>();
            <span class="code-keyword">SAVEPOINT</span> sp_order_created;
            
            <span class="code-keyword">INSERT INTO</span> order_items (order_id, product_id, quantity)
            <span class="code-keyword">VALUES</span> (@order_id, <span class="code-number">10</span>, <span class="code-number">5</span>);
            
            <span class="code-keyword">SAVEPOINT</span> sp_items_added;
            
            <span class="code-comment">-- Error recovery</span>
            <span class="code-keyword">ROLLBACK TO</span> sp_order_created;  <span class="code-comment">-- Undo items, keep order</span>
            
            <span class="code-keyword">INSERT INTO</span> order_items (order_id, product_id, quantity)
            <span class="code-keyword">VALUES</span> (@order_id, <span class="code-number">20</span>, <span class="code-number">3</span>);  <span class="code-comment">-- Different item</span>
            
          <span class="code-keyword">COMMIT</span>;
        </div>

        <div class="tip-box">
          ‚úÖ Use <strong>SAVEPOINT</strong> for fine-grained control over transaction rollback points
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üìä</span>
          <span class="card-title">Transaction Isolation Levels</span>
        </div>
        
        <div class="code-block">
          <span class="code-comment">-- View current isolation level</span>
          <span class="code-keyword">SELECT</span> @@transaction_isolation;
          
          <span class="code-comment">-- READ UNCOMMITTED: No isolation, dirty reads possible</span>
          <span class="code-keyword">SET SESSION</span> <span class="code-keyword">TRANSACTION ISOLATION LEVEL READ UNCOMMITTED</span>;
          
          <span class="code-comment">-- READ COMMITTED: Prevents dirty reads</span>
          <span class="code-keyword">SET SESSION</span> <span class="code-keyword">TRANSACTION ISOLATION LEVEL READ COMMITTED</span>;
          
          <span class="code-comment">-- REPEATABLE READ (Default): Prevents dirty and non-repeatable reads</span>
          <span class="code-keyword">SET SESSION</span> <span class="code-keyword">TRANSACTION ISOLATION LEVEL REPEATABLE READ</span>;
          
          <span class="code-comment">-- SERIALIZABLE: Highest level, all anomalies prevented</span>
          <span class="code-keyword">SET SESSION</span> <span class="code-keyword">TRANSACTION ISOLATION LEVEL SERIALIZABLE</span>;
          
          <span class="code-comment">-- Set globally</span>
          <span class="code-keyword">SET GLOBAL</span> transaction_isolation = <span class="code-string">'READ_COMMITTED'</span>;
        </div>

        <table class="comparison-table">
          <tr>
            <th>Isolation Level</th>
            <th>Dirty Read</th>
            <th>Non-Repeatable</th>
            <th>Phantom</th>
            <th>Performance</th>
          </tr>
          <tr>
            <td>READ UNCOMMITTED</td>
            <td>Possible</td>
            <td>Possible</td>
            <td>Possible</td>
            <td>Fastest</td>
          </tr>
          <tr>
            <td>READ COMMITTED</td>
            <td>Prevented</td>
            <td>Possible</td>
            <td>Possible</td>
            <td>Fast</td>
          </tr>
          <tr>
            <td>REPEATABLE READ</td>
            <td>Prevented</td>
            <td>Prevented</td>
            <td>Possible*</td>
            <td>Balanced</td>
          </tr>
          <tr>
            <td>SERIALIZABLE</td>
            <td>Prevented</td>
            <td>Prevented</td>
            <td>Prevented</td>
            <td>Slowest</td>
          </tr>
        </table>

        <div class="info-box">
          üí° *InnoDB prevents phantom reads in REPEATABLE READ through next-key locking
        </div>
      </div>
    </div>

    <!-- Concurrency Control -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üîí</span>
          <span class="card-title">Concurrency Control & Locking</span>
        </div>
        
        <div class="section-title">Implicit Locking</div>
        <div class="code-block">
          <span class="code-comment">-- InnoDB automatically locks on modifications</span>
          <span class="code-keyword">BEGIN</span>;
            <span class="code-keyword">UPDATE</span> orders <span class="code-keyword">SET</span> status = <span class="code-string">'processing'</span> <span class="code-keyword">WHERE</span> order_id = <span class="code-number">1</span>;
            <span class="code-comment">-- Row 1 is locked, other transactions wait</span>
          <span class="code-keyword">COMMIT</span>;
        </div>

        <div class="section-title">Explicit Row Locking</div>
        <div class="code-block">
          <span class="code-comment">-- SELECT FOR UPDATE (exclusive lock)</span>
          <span class="code-keyword">BEGIN</span>;
            <span class="code-keyword">SELECT</span> balance <span class="code-keyword">FROM</span> accounts 
            <span class="code-keyword">WHERE</span> account_id = <span class="code-number">1</span> <span class="code-keyword">FOR UPDATE</span>;
            <span class="code-comment">-- Lock acquired, other transactions wait</span>
            <span class="code-keyword">UPDATE</span> accounts <span class="code-keyword">SET</span> balance = balance - <span class="code-number">100</span> <span class="code-keyword">WHERE</span> account_id = <span class="code-number">1</span>;
          <span class="code-keyword">COMMIT</span>;
          
          <span class="code-comment">-- SELECT FOR SHARE (shared lock - read lock)</span>
          <span class="code-keyword">BEGIN</span>;
            <span class="code-keyword">SELECT</span> balance <span class="code-keyword">FROM</span> accounts 
            <span class="code-keyword">WHERE</span> account_id = <span class="code-number">1</span> <span class="code-keyword">FOR SHARE</span>;
            <span class="code-comment">-- Other transactions can read, but can't modify</span>
            <span class="code-comment">-- Multiple transactions can hold shared locks simultaneously</span>
          <span class="code-keyword">COMMIT</span>;
        </div>

        <div class="section-title">Deadlock Handling</div>
        <div class="code-block">
          <span class="code-keyword">DELIMITER</span> //
          
          <span class="code-keyword">CREATE PROCEDURE</span> transfer_money(
            <span class="code-keyword">IN</span> FROM_ACCOUNT <span class="code-keyword">INT</span>,
            <span class="code-keyword">IN</span> TO_ACCOUNT <span class="code-keyword">INT</span>,
            <span class="code-keyword">IN</span> AMOUNT <span class="code-keyword">DECIMAL</span>(<span class="code-number">10</span>, <span class="code-number">2</span>)
          )
          <span class="code-keyword">BEGIN</span>
            <span class="code-keyword">DECLARE EXIT HANDLER FOR SQLEXCEPTION</span>
            <span class="code-keyword">BEGIN</span>
              <span class="code-keyword">ROLLBACK</span>;
              <span class="code-keyword">INSERT INTO</span> transfer_errors (
                from_account, to_account, amount, error_time
              ) <span class="code-keyword">VALUES</span> (FROM_ACCOUNT, TO_ACCOUNT, AMOUNT, <span class="code-keyword">NOW</span>());
            <span class="code-keyword">END</span>;
            
            <span class="code-keyword">START TRANSACTION</span>;
              <span class="code-comment">-- Lock accounts in order to prevent deadlock</span>
              <span class="code-comment">-- Lock from_account first</span>
              <span class="code-keyword">SELECT</span> balance <span class="code-keyword">INTO</span> @from_balance <span class="code-keyword">FROM</span> accounts 
              <span class="code-keyword">WHERE</span> account_id = FROM_ACCOUNT <span class="code-keyword">FOR UPDATE</span>;
              
              <span class="code-keyword">IF</span> @from_balance >= AMOUNT <span class="code-keyword">THEN</span>
                <span class="code-comment">-- Lock to_account</span>
                <span class="code-keyword">SELECT</span> balance <span class="code-keyword">INTO</span> @to_balance <span class="code-keyword">FROM</span> accounts 
                <span class="code-keyword">WHERE</span> account_id = TO_ACCOUNT <span class="code-keyword">FOR UPDATE</span>;
                
                <span class="code-keyword">UPDATE</span> accounts <span class="code-keyword">SET</span> balance = balance - AMOUNT <span class="code-keyword">WHERE</span> account_id = FROM_ACCOUNT;
                <span class="code-keyword">UPDATE</span> accounts <span class="code-keyword">SET</span> balance = balance + AMOUNT <span class="code-keyword">WHERE</span> account_id = TO_ACCOUNT;
              <span class="code-keyword">END IF</span>;
            <span class="code-keyword">COMMIT</span>;
          <span class="code-keyword">END</span> //
          
          <span class="code-keyword">DELIMITER</span> ;
        </div>

        <div class="tip-box">
          ‚úÖ Always lock resources in the same order to prevent deadlocks. Use consistent locking strategies.
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üìä</span>
          <span class="card-title">Monitoring Locks</span>
        </div>
        
        <div class="code-block">
          <span class="code-comment">-- Check current locking behavior</span>
          <span class="code-keyword">SHOW OPEN TABLES</span> <span class="code-keyword">WHERE</span> In_use > <span class="code-number">0</span>;
          
          <span class="code-comment">-- View locked queries</span>
          <span class="code-keyword">SHOW PROCESSLIST</span>;  
          
          <span class="code-comment">-- Detailed lock info</span>
          <span class="code-keyword">SHOW ENGINE INNODB STATUS</span>;
          
          <span class="code-comment">-- Kill problematic queries</span>
          <span class="code-keyword">KILL</span> <span class="code-keyword">QUERY</span> process_id;
          <span class="code-keyword">KILL</span> <span class="code-keyword">CONNECTION</span> process_id;
        </div>

        <div class="info-box">
          üí° <strong>Lock Wait Timeout:</strong> Default is 50 seconds. Adjust with <code>innodb_lock_wait_timeout</code> variable
        </div>
      </div>
    </div>

    <!-- MySQL Replication -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üîÑ</span>
          <span class="card-title">Master-Slave Replication</span>
        </div>
        
        <div class="section-title">On Master Server</div>
        <div class="code-block">
          <span class="code-comment">-- Enable binary logging in my.cnf</span>
          <span class="code-comment">-- [mysqld]</span>
          <span class="code-comment">-- server-id = 1</span>
          <span class="code-comment">-- log_bin = /var/log/mysql/mysql-bin.log</span>
          <span class="code-comment">-- binlog_format = ROW  -- or MIXED/STATEMENT</span>
          
          <span class="code-comment">-- Create replication user</span>
          <span class="code-keyword">CREATE USER</span> <span class="code-string">'repl_user'</span>@<span class="code-string">'slave_ip'</span> <span class="code-keyword">IDENTIFIED BY</span> <span class="code-string">'strong_password'</span>;
          <span class="code-keyword">GRANT REPLICATION SLAVE</span>, <span class="code-keyword">REPLICATION CLIENT ON</span> *.* <span class="code-keyword">TO</span> <span class="code-string">'repl_user'</span>@<span class="code-string">'slave_ip'</span>;
          <span class="code-keyword">FLUSH PRIVILEGES</span>;
          
          <span class="code-comment">-- Get current binary log position</span>
          <span class="code-keyword">SHOW MASTER STATUS</span>;
          <span class="code-comment">-- File: mysql-bin.000001, Position: 1234</span>
        </div>

        <div class="section-title">On Slave Server</div>
        <div class="code-block">
          <span class="code-comment">-- Configure in my.cnf</span>
          <span class="code-comment">-- [mysqld]</span>
          <span class="code-comment">-- server-id = 2</span>
          <span class="code-comment">-- relay-log = /var/log/mysql/mysql-relay-bin</span>
          <span class="code-comment">-- log_bin = /var/log/mysql/mysql-bin.log</span>
          
          <span class="code-comment">-- Setup slave replication</span>
          <span class="code-keyword">CHANGE MASTER TO</span>
            <span class="code-keyword">MASTER_HOST</span> = <span class="code-string">'master_ip'</span>,
            <span class="code-keyword">MASTER_USER</span> = <span class="code-string">'repl_user'</span>,
            <span class="code-keyword">MASTER_PASSWORD</span> = <span class="code-string">'strong_password'</span>,
            <span class="code-keyword">MASTER_LOG_FILE</span> = <span class="code-string">'mysql-bin.000001'</span>,
            <span class="code-keyword">MASTER_LOG_POS</span> = <span class="code-number">1234</span>;
          
          <span class="code-comment">-- Start slave</span>
          <span class="code-keyword">START SLAVE</span>;
          
          <span class="code-comment">-- Monitor replication status</span>
          <span class="code-keyword">SHOW SLAVE STATUS</span>\G
          <span class="code-comment">-- Should show: Slave_IO_Running: Yes, Slave_SQL_Running: Yes</span>
        </div>

        <div class="info-box">
          üí° <strong>Replication Types:</strong><br>
          ‚Ä¢ <strong>STATEMENT:</strong> Replicates SQL statements (smaller, less precise)<br>
          ‚Ä¢ <strong>ROW:</strong> Replicates row changes (larger, more precise)<br>
          ‚Ä¢ <strong>MIXED:</strong> MySQL chooses between statement and row
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üåê</span>
          <span class="card-title">Multi-Source Replication</span>
        </div>
        
        <div class="highlight">
          <strong>Multi-Source Replication</strong> allows one slave to replicate from multiple masters (MySQL 5.7+)
        </div>

        <div class="code-block">
          <span class="code-comment">-- Configure multiple masters</span>
          <span class="code-keyword">CHANGE MASTER TO</span>
            <span class="code-keyword">MASTER_HOST</span> = <span class="code-string">'master1'</span>,
            <span class="code-keyword">MASTER_USER</span> = <span class="code-string">'repl_user'</span>,
            <span class="code-keyword">MASTER_PASSWORD</span> = <span class="code-string">'password'</span>,
            <span class="code-keyword">MASTER_LOG_FILE</span> = <span class="code-string">'mysql-bin.000001'</span>,
            <span class="code-keyword">MASTER_LOG_POS</span> = <span class="code-number">1234</span>
            <span class="code-keyword">FOR CHANNEL</span> <span class="code-string">'master1'</span>;
          
          <span class="code-keyword">CHANGE MASTER TO</span>
            <span class="code-keyword">MASTER_HOST</span> = <span class="code-string">'master2'</span>,
            <span class="code-keyword">MASTER_USER</span> = <span class="code-string">'repl_user'</span>,
            <span class="code-keyword">MASTER_PASSWORD</span> = <span class="code-string">'password'</span>,
            <span class="code-keyword">MASTER_LOG_FILE</span> = <span class="code-string">'mysql-bin.000001'</span>,
            <span class="code-keyword">MASTER_LOG_POS</span> = <span class="code-number">1234</span>
            <span class="code-keyword">FOR CHANNEL</span> <span class="code-string">'master2'</span>;
          
          <span class="code-keyword">START SLAVE</span> <span class="code-keyword">FOR CHANNEL</span> <span class="code-string">'master1'</span>;
          <span class="code-keyword">START SLAVE</span> <span class="code-keyword">FOR CHANNEL</span> <span class="code-string">'master2'</span>;
          
          <span class="code-comment">-- View replication status for all channels</span>
          <span class="code-keyword">SELECT</span> * <span class="code-keyword">FROM</span> performance_schema.replication_connection_status;
        </div>

        <div class="warning-box">
          ‚ö†Ô∏è Multi-source replication requires careful conflict resolution planning. Use different databases on each master to avoid primary key conflicts.
        </div>
      </div>
    </div>

    <!-- Backup and Recovery -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üíæ</span>
          <span class="card-title">Logical Backup with mysqldump</span>
        </div>
        
        <div class="code-block">
          <span class="code-comment">-- Full database backup</span>
          mysqldump -u root -p --all-databases > full_backup.sql
          
          <span class="code-comment">-- Specific database</span>
          mysqldump -u root -p database_name > database_backup.sql
          
          <span class="code-comment">-- With binary log for point-in-time recovery</span>
          mysqldump -u root -p --all-databases --master-data=<span class="code-number">2</span> --single-transaction > backup.sql
          
          <span class="code-comment">-- Backup only structure</span>
          mysqldump -u root -p --no-data database_name > structure_only.sql
          
          <span class="code-comment">-- Backup only data</span>
          mysqldump -u root -p --no-create-info database_name > data_only.sql
          
          <span class="code-comment">-- Restore from backup</span>
          mysql -u root -p < backup.sql
        </div>

        <div class="section-title">Advanced mysqldump Options</div>
        <div class="code-block">
          <span class="code-comment">-- Compress backup</span>
          mysqldump -u root -p database_name | gzip > backup.sql.gz
          
          <span class="code-comment">-- Backup with consistent snapshot (InnoDB)</span>
          mysqldump -u root -p --single-transaction --routines --triggers database_name > backup.sql
          
          <span class="code-comment">-- Parallel backup (MySQL 8.0+)</span>
          mysqlpump -u root -p --default-parallelism=<span class="code-number">4</span> database_name > backup.sql
        </div>

        <div class="info-box">
          üí° <strong>--single-transaction:</strong> Ensures consistent backup for InnoDB tables without locking. Use for live systems.
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üìÅ</span>
          <span class="card-title">Physical Backup</span>
        </div>
        
        <div class="code-block">
          <span class="code-comment">-- Copy data files directly (requires shutdown or backup lock)</span>
          mysql -u root -p -e <span class="code-string">"FLUSH TABLES WITH READ LOCK;"</span>
          cp -r /var/lib/mysql/data_directory /backup/location/
          
          <span class="code-comment">-- Or use InnoDB Hot Backup</span>
          <span class="code-comment">-- percona-xtrabackup --backup --target-dir=/backup/location/</span>
          
          <span class="code-comment">-- MySQL Enterprise Backup</span>
          mysqlbackup --backup-dir=/backup/location/ backup
          
          <span class="code-comment">-- Point-in-Time Recovery</span>
          <span class="code-comment">-- Restore from backup</span>
          mysql -u root -p < full_backup.sql
          
          <span class="code-comment">-- Apply binary logs up to specific time</span>
          mysqlbinlog --stop-datetime=<span class="code-string">'2024-01-15 14:30:00'</span> /var/log/mysql/mysql-bin.000001 | mysql -u root -p
        </div>

        <div class="section-title">Backup Strategy Example</div>
        <div class="code-block">
          <span class="code-comment">-- Create backup tracking table</span>
          <span class="code-keyword">CREATE TABLE</span> backup_schedule (
            backup_id <span class="code-keyword">INT PRIMARY KEY AUTO_INCREMENT</span>,
            backup_type <span class="code-keyword">VARCHAR</span>(<span class="code-number">50</span>),  <span class="code-comment">-- 'full', 'incremental', 'daily'</span>
            backup_date <span class="code-keyword">DATETIME</span>,
            retention_days <span class="code-keyword">INT</span>,
            schedule <span class="code-keyword">ENUM</span>(<span class="code-string">'daily'</span>, <span class="code-string">'weekly'</span>, <span class="code-string">'monthly'</span>),
            created_at <span class="code-keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>
          );
          
          <span class="code-comment">-- Full backup weekly, incrementals daily</span>
          <span class="code-keyword">INSERT INTO</span> backup_schedule (backup_type, retention_days, schedule)
          <span class="code-keyword">VALUES</span> 
            (<span class="code-string">'full'</span>, <span class="code-number">30</span>, <span class="code-string">'weekly'</span>),
            (<span class="code-string">'incremental'</span>, <span class="code-number">7</span>, <span class="code-string">'daily'</span>);
        </div>

        <div class="warning-box">
          ‚ö†Ô∏è Physical backups are faster but require same MySQL version and platform for restore. Logical backups are more portable.
        </div>
      </div>
    </div>

    <!-- Table Partitioning -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üìä</span>
          <span class="card-title">Table Partitioning</span>
        </div>
        
        <div class="section-title">Range Partitioning (by Date)</div>
        <div class="code-block">
          <span class="code-comment">-- Create partitioned table</span>
          <span class="code-keyword">CREATE TABLE</span> sales_data (
            sale_id <span class="code-keyword">INT PRIMARY KEY AUTO_INCREMENT</span>,
            customer_id <span class="code-keyword">INT</span>,
            sale_date <span class="code-keyword">DATE</span>,
            amount <span class="code-keyword">DECIMAL</span>(<span class="code-number">12</span>, <span class="code-number">2</span>)
          )
          <span class="code-keyword">PARTITION BY RANGE</span> (<span class="code-keyword">YEAR</span>(sale_date)) (
            <span class="code-keyword">PARTITION</span> p_2022 <span class="code-keyword">VALUES LESS THAN</span> (<span class="code-number">2023</span>),
            <span class="code-keyword">PARTITION</span> p_2023 <span class="code-keyword">VALUES LESS THAN</span> (<span class="code-number">2024</span>),
            <span class="code-keyword">PARTITION</span> p_2024 <span class="code-keyword">VALUES LESS THAN</span> (<span class="code-number">2025</span>),
            <span class="code-keyword">PARTITION</span> p_future <span class="code-keyword">VALUES LESS THAN</span> <span class="code-keyword">MAXVALUE</span>
          );
          
          <span class="code-comment">-- Benefits:</span>
          <span class="code-comment">-- ‚Ä¢ Faster queries on recent data</span>
          <span class="code-comment">-- ‚Ä¢ Easier archival of old partitions</span>
          <span class="code-comment">-- ‚Ä¢ Parallel query execution on partitions</span>
        </div>

        <div class="section-title">List Partitioning (by Category)</div>
        <div class="code-block">
          <span class="code-keyword">CREATE TABLE</span> customers_by_region (
            customer_id <span class="code-keyword">INT PRIMARY KEY</span>,
            customer_name <span class="code-keyword">VARCHAR</span>(<span class="code-number">100</span>),
            region <span class="code-keyword">VARCHAR</span>(<span class="code-number">50</span>)
          )
          <span class="code-keyword">PARTITION BY LIST</span> (<span class="code-keyword">CHAR_LENGTH</span>(region)) (
            <span class="code-keyword">PARTITION</span> p_north <span class="code-keyword">VALUES IN</span> (<span class="code-string">'North'</span>),
            <span class="code-keyword">PARTITION</span> p_south <span class="code-keyword">VALUES IN</span> (<span class="code-string">'South'</span>),
            <span class="code-keyword">PARTITION</span> p_east <span class="code-keyword">VALUES IN</span> (<span class="code-string">'East'</span>),
            <span class="code-keyword">PARTITION</span> p_west <span class="code-keyword">VALUES IN</span> (<span class="code-string">'West'</span>)
          );
        </div>

        <div class="section-title">Hash Partitioning (for Distribution)</div>
        <div class="code-block">
          <span class="code-comment">-- Distribute data evenly across partitions</span>
          <span class="code-keyword">CREATE TABLE</span> orders_distributed (
            order_id <span class="code-keyword">INT PRIMARY KEY</span>,
            customer_id <span class="code-keyword">INT</span>,
            order_date <span class="code-keyword">DATE</span>,
            total_amount <span class="code-keyword">DECIMAL</span>(<span class="code-number">12</span>, <span class="code-number">2</span>)
          )
          <span class="code-keyword">PARTITION BY HASH</span> (customer_id)
          <span class="code-keyword">PARTITIONS</span> <span class="code-number">10</span>;  <span class="code-comment">-- Creates 10 partitions</span>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">‚öôÔ∏è</span>
          <span class="card-title">Managing Partitions</span>
        </div>
        
        <div class="code-block">
          <span class="code-comment">-- Add new partition</span>
          <span class="code-keyword">ALTER TABLE</span> sales_data
          <span class="code-keyword">ADD PARTITION</span> (<span class="code-keyword">PARTITION</span> p_2025 <span class="code-keyword">VALUES LESS THAN</span> (<span class="code-number">2026</span>));
          
          <span class="code-comment">-- Remove partition (fast operation)</span>
          <span class="code-keyword">ALTER TABLE</span> sales_data
          <span class="code-keyword">DROP PARTITION</span> p_2022;
          
          <span class="code-comment">-- View partition information</span>
          <span class="code-keyword">SELECT</span> 
            TABLE_NAME,
            PARTITION_NAME,
            PARTITION_METHOD,
            PARTITION_EXPRESSION,
            PARTITION_DESCRIPTION
          <span class="code-keyword">FROM</span> information_schema.PARTITIONS
          <span class="code-keyword">WHERE</span> TABLE_NAME = <span class="code-string">'sales_data'</span>;
          
          <span class="code-comment">-- Analyze partitions</span>
          <span class="code-keyword">ALTER TABLE</span> sales_data <span class="code-keyword">ANALYZE PARTITION</span> p_2023, p_2024;
          
          <span class="code-comment">-- Reorganize partitions</span>
          <span class="code-keyword">ALTER TABLE</span> sales_data
          <span class="code-keyword">REORGANIZE PARTITION</span> p_future <span class="code-keyword">INTO</span> (
            <span class="code-keyword">PARTITION</span> p_2025 <span class="code-keyword">VALUES LESS THAN</span> (<span class="code-number">2026</span>),
            <span class="code-keyword">PARTITION</span> p_max <span class="code-keyword">VALUES LESS THAN</span> <span class="code-keyword">MAXVALUE</span>
          );
        </div>

        <div class="info-box">
          üí° <strong>Partitioning Benefits:</strong><br>
          ‚Ä¢ Query performance: Prunes irrelevant partitions<br>
          ‚Ä¢ Maintenance: Operate on individual partitions<br>
          ‚Ä¢ Storage: Store different partitions on different disks
        </div>
      </div>
    </div>

    <!-- High Availability -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üåê</span>
          <span class="card-title">MySQL Group Replication</span>
        </div>
        
        <div class="highlight">
          <strong>Group Replication</strong> provides distributed, fault-tolerant, highly available MySQL service with automatic failover.
        </div>

        <div class="code-block">
          <span class="code-comment">-- Server 1: Bootstrap primary</span>
          <span class="code-keyword">SET GLOBAL</span> group_replication_bootstrap_group_recovery = <span class="code-keyword">ON</span>;
          <span class="code-keyword">CHANGE MASTER TO</span> <span class="code-keyword">MASTER_USER</span> = <span class="code-string">'rpl_user'</span>, <span class="code-keyword">MASTER_PASSWORD</span> = <span class="code-string">'password'</span> 
          <span class="code-keyword">FOR CHANNEL</span> <span class="code-string">'group_replication_recovery'</span>;
          <span class="code-keyword">START GROUP_REPLICATION</span>;
          
          <span class="code-comment">-- Server 2 & 3: Join the group</span>
          <span class="code-keyword">CHANGE MASTER TO</span> <span class="code-keyword">MASTER_USER</span> = <span class="code-string">'rpl_user'</span>, <span class="code-keyword">MASTER_PASSWORD</span> = <span class="code-string">'password'</span> 
          <span class="code-keyword">FOR CHANNEL</span> <span class="code-string">'group_replication_recovery'</span>;
          <span class="code-keyword">START GROUP_REPLICATION</span>;
          
          <span class="code-comment">-- View group status</span>
          <span class="code-keyword">SELECT</span> * <span class="code-keyword">FROM</span> performance_schema.replication_group_members;
          
          <span class="code-comment">-- Query always goes to primary automatically</span>
          <span class="code-comment">-- Automatic failover on primary failure</span>
        </div>

        <div class="info-box">
          üí° Group Replication provides:<br>
          ‚Ä¢ Automatic primary election<br>
          ‚Ä¢ Distributed recovery<br>
          ‚Ä¢ Consistent data across members<br>
          ‚Ä¢ Built-in conflict detection
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üìä</span>
          <span class="card-title">Administration Monitoring</span>
        </div>
        
        <div class="code-block">
          <span class="code-comment">-- Monitor replication lag</span>
          <span class="code-keyword">SELECT</span> 
            slave_io_state,
            master_host,
            seconds_behind_master,
            slave_io_running,
            slave_sql_running
          <span class="code-keyword">FROM</span> information_schema.processlist
          <span class="code-keyword">WHERE</span> command = <span class="code-string">'Binlog Dump'</span>;
          
          <span class="code-comment">-- Check binary log status</span>
          <span class="code-keyword">SHOW BINARY LOGS</span>;
          
          <span class="code-comment">-- Monitor table sizes</span>
          <span class="code-keyword">SELECT</span> 
            table_schema,
            table_name,
            <span class="code-keyword">ROUND</span>(data_length / <span class="code-number">1024</span> / <span class="code-number">1024</span>, <span class="code-number">2</span>) <span class="code-keyword">as</span> data_mb,
            <span class="code-keyword">ROUND</span>(index_length / <span class="code-number">1024</span> / <span class="code-number">1024</span>, <span class="code-number">2</span>) <span class="code-keyword">as</span> index_mb
          <span class="code-keyword">FROM</span> information_schema.tables
          <span class="code-keyword">WHERE</span> table_schema = <span class="code-string">'your_database'</span>
          <span class="code-keyword">ORDER BY</span> (data_length + index_length) <span class="code-keyword">DESC</span>;
          
          <span class="code-comment">-- Monitor connection usage</span>
          <span class="code-keyword">SHOW STATUS</span> <span class="code-keyword">LIKE</span> <span class="code-string">'Threads_%'</span>;
          <span class="code-keyword">SHOW STATUS</span> <span class="code-keyword">LIKE</span> <span class="code-string">'Connections'</span>;
          <span class="code-keyword">SHOW STATUS</span> <span class="code-keyword">LIKE</span> <span class="code-string">'Max_used_connections'</span>;
        </div>

        <div class="section-title">Performance Schema Queries</div>
        <div class="code-block">
          <span class="code-comment">-- Top queries by execution time</span>
          <span class="code-keyword">SELECT</span> 
            query,
            exec_count,
            <span class="code-keyword">AVG</span>(timer_wait/<span class="code-number">1000000000</span>) <span class="code-keyword">as</span> avg_seconds
          <span class="code-keyword">FROM</span> performance_schema.events_statements_summary_by_digest
          <span class="code-keyword">ORDER BY</span> timer_wait <span class="code-keyword">DESC</span>
          <span class="code-keyword">LIMIT</span> <span class="code-number">10</span>;
          
          <span class="code-comment">-- File I/O statistics</span>
          <span class="code-keyword">SELECT</span> * 
          <span class="code-keyword">FROM</span> performance_schema.file_summary_by_instance
          <span class="code-keyword">ORDER BY</span> sum_number_of_bytes_read + sum_number_of_bytes_write <span class="code-keyword">DESC</span>
          <span class="code-keyword">LIMIT</span> <span class="code-number">10</span>;
        </div>

        <div class="tag">monitoring</div>
        <div class="tag">performance</div>
        <div class="tag">replication</div>
      </div>
    </div>

    <!-- Learning Checklist -->
    <div class="grid">
      <div class="card full-width">
        <div class="card-header">
          <span class="card-icon">‚úÖ</span>
          <span class="card-title">Learning Checklist</span>
        </div>
        
        <div class="two-col">
          <div>
            <div class="list-item">Understand ACID properties and transaction behavior</div>
            <div class="list-item">Implement COMMIT and ROLLBACK properly</div>
            <div class="list-item">Use SAVEPOINT for partial rollbacks</div>
            <div class="list-item">Configure appropriate isolation levels</div>
            <div class="list-item">Use row-level locking and shared locks</div>
            <div class="list-item">Prevent and handle deadlocks</div>
          </div>
          <div>
            <div class="list-item">Setup master-slave replication</div>
            <div class="list-item">Execute physical and logical backups</div>
            <div class="list-item">Implement point-in-time recovery</div>
            <div class="list-item">Partition tables for performance</div>
            <div class="list-item">Configure Group Replication for HA</div>
            <div class="list-item">Monitor database health and performance</div>
          </div>
        </div>

        <div class="tag">transactions</div>
        <div class="tag">replication</div>
        <div class="tag">backup</div>
        <div class="tag">recovery</div>
        <div class="tag">partitioning</div>
        <div class="tag">administration</div>
      </div>
    </div>

    <div class="footer">
      <p>MySQL Cheat Sheet #6 - Advanced Administration ‚Ä¢ Complete MySQL Knowledge Base</p>
    </div>
  </div>
</body>
</html>