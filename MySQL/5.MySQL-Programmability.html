<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MySQL Cheat Sheet #5 - Programmability</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      border-radius: 15px;
    }
    .header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      color: #fff;
    }
    .header .subtitle {
      color: #fff;
      font-size: 1.1em;
      opacity: 0.9;
    }
    .badge {
      display: inline-block;
      background: rgba(0,0,0,0.3);
      color: #fff;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.85em;
      margin-top: 10px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    .card {
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(245,87,108,0.3);
    }
    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f5576c;
    }
    .card-icon {
      font-size: 1.8em;
      margin-right: 12px;
    }
    .card-title {
      font-size: 1.3em;
      color: #f5576c;
    }
    .code-block {
      background: #0d1117;
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.85em;
      overflow-x: auto;
      border-left: 3px solid #f5576c;
    }
    .code-comment {
      color: #6a737d;
    }
    .code-keyword {
      color: #ff7b72;
    }
    .code-string {
      color: #a5d6ff;
    }
    .code-method {
      color: #d2a8ff;
    }
    .code-number {
      color: #79c0ff;
    }
    .code-prop {
      color: #7ee787;
    }
    .highlight {
      background: linear-gradient(135deg, rgba(240,147,251,0.2), rgba(245,87,108,0.2));
      padding: 15px;
      border-radius: 10px;
      margin: 10px 0;
    }
    .list-item {
      padding: 8px 0;
      padding-left: 20px;
      position: relative;
    }
    .list-item::before {
      content: "‚ñ∏";
      position: absolute;
      left: 0;
      color: #f5576c;
    }
    .tag {
      display: inline-block;
      background: rgba(245,87,108,0.2);
      color: #f5576c;
      padding: 3px 10px;
      border-radius: 5px;
      font-size: 0.8em;
      margin: 2px;
    }
    .tag-blue {
      background: rgba(52,152,219,0.2);
      color: #3498db;
    }
    .tag-green {
      background: rgba(46,204,113,0.2);
      color: #2ecc71;
    }
    .tag-purple {
      background: rgba(155,89,182,0.2);
      color: #9b59b6;
    }
    .full-width {
      grid-column: 1 / -1;
    }
    .info-box {
      background: rgba(52,152,219,0.1);
      border-left: 3px solid #3498db;
      padding: 12px;
      border-radius: 0 8px 8px 0;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .warning-box {
      background: rgba(231,76,60,0.1);
      border-left: 3px solid #e74c3c;
      padding: 12px;
      border-radius: 0 8px 8px 0;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .tip-box {
      background: rgba(46,204,113,0.1);
      border-left: 3px solid #2ecc71;
      padding: 12px;
      border-radius: 0 8px 8px 0;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .section-title {
      color: #f5576c;
      font-size: 1.1em;
      margin: 15px 0 10px 0;
      padding-bottom: 5px;
      border-bottom: 1px dashed rgba(245,87,108,0.3);
    }
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .comparison-table th, .comparison-table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .comparison-table th {
      background: rgba(245,87,108,0.2);
      color: #f5576c;
    }
    .comparison-table tr:hover {
      background: rgba(255,255,255,0.05);
    }
    .flex-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 0;
    }
    .footer {
      text-align: center;
      padding: 20px;
      color: rgba(255,255,255,0.5);
      font-size: 0.9em;
    }
    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    @media (max-width: 768px) {
      .two-col {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üîß MySQL Cheat Sheet #5</h1>
      <div class="subtitle">Programmability ‚Äî Stored Procedures, Functions, Triggers, Views</div>
      <div class="badge">‚öôÔ∏è Procedures ‚Ä¢ Functions ‚Ä¢ Triggers ‚Ä¢ Views</div>
    </div>

    <!-- Stored Procedures -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">‚öôÔ∏è</span>
          <span class="card-title">Stored Procedures - Basic</span>
        </div>
        
        <div class="code-block">
          <span class="code-keyword">DELIMITER</span> //
          
          <span class="code-keyword">CREATE PROCEDURE</span> get_customer_orders(<span class="code-keyword">IN</span> customer_id_param <span class="code-keyword">INT</span>)
          <span class="code-keyword">BEGIN</span>
            <span class="code-keyword">SELECT</span> 
              order_id,
              order_date,
              total_amount,
              status
            <span class="code-keyword">FROM</span> orders
            <span class="code-keyword">WHERE</span> customer_id = customer_id_param
            <span class="code-keyword">ORDER BY</span> order_date <span class="code-keyword">DESC</span>;
          <span class="code-keyword">END</span> //
          
          <span class="code-keyword">DELIMITER</span> ;
          
          <span class="code-comment">-- Call procedure</span>
          <span class="code-keyword">CALL</span> get_customer_orders(<span class="code-number">5</span>);
        </div>

        <div class="tip-box">
          ‚úÖ Use <strong>DELIMITER</strong> to change statement terminator temporarily when creating procedures
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üîÑ</span>
          <span class="card-title">Stored Procedures - Output Parameters</span>
        </div>
        
        <div class="code-block">
          <span class="code-keyword">DELIMITER</span> //
          
          <span class="code-keyword">CREATE PROCEDURE</span> get_customer_stats(
            <span class="code-keyword">IN</span> customer_id_param <span class="code-keyword">INT</span>,
            <span class="code-keyword">OUT</span> total_orders <span class="code-keyword">OUT INT</span>,
            <span class="code-keyword">OUT</span> lifetime_value <span class="code-keyword">OUT DECIMAL</span>(<span class="code-number">12</span>, <span class="code-number">2</span>),
            <span class="code-keyword">OUT</span> last_order_date <span class="code-keyword">OUT DATE</span>
          )
          <span class="code-keyword">BEGIN</span>
            <span class="code-keyword">SELECT</span> 
              <span class="code-keyword">COUNT</span>(*),
              <span class="code-keyword">SUM</span>(total_amount),
              <span class="code-keyword">MAX</span>(order_date)
            <span class="code-keyword">INTO</span> total_orders, lifetime_value, last_order_date
            <span class="code-keyword">FROM</span> orders
            <span class="code-keyword">WHERE</span> customer_id = customer_id_param;
          <span class="code-keyword">END</span> //
          
          <span class="code-keyword">DELIMITER</span> ;
          
          <span class="code-comment">-- Call and capture output</span>
          <span class="code-keyword">CALL</span> get_customer_stats(<span class="code-number">5</span>, @orders, @value, @date);
          <span class="code-keyword">SELECT</span> @orders, @value, @date;
        </div>

        <div class="info-box">
          üí° <strong>Parameter Types:</strong><br>
          ‚Ä¢ <strong>IN:</strong> Input parameter (read-only)<br>
          ‚Ä¢ <strong>OUT:</strong> Output parameter (write-only)<br>
          ‚Ä¢ <strong>INOUT:</strong> Both input and output
        </div>
      </div>
    </div>

    <!-- Advanced Procedures -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üîÑ</span>
          <span class="card-title">Procedures with Control Flow</span>
        </div>
        
        <div class="code-block">
          <span class="code-keyword">DELIMITER</span> //
          
          <span class="code-keyword">CREATE PROCEDURE</span> process_monthly_orders()
          <span class="code-keyword">BEGIN</span>
            <span class="code-keyword">DECLARE</span> total_processed <span class="code-keyword">INT DEFAULT 0</span>;
            <span class="code-keyword">DECLARE</span> continue_flag <span class="code-keyword">BOOLEAN DEFAULT TRUE</span>;
            <span class="code-keyword">DECLARE</span> error_msg <span class="code-keyword">VARCHAR</span>(<span class="code-number">255</span>);
            
            <span class="code-keyword">DECLARE CONTINUE HANDLER FOR SQLEXCEPTION</span>
            <span class="code-keyword">BEGIN</span>
              <span class="code-keyword">SET</span> error_msg = <span class="code-string">'Error processing orders'</span>;
            <span class="code-keyword">END</span>;
            
            <span class="code-keyword">START TRANSACTION</span>;
            
            <span class="code-keyword">BEGIN</span>
              <span class="code-keyword">UPDATE</span> orders
              <span class="code-keyword">SET</span> status = <span class="code-string">'processing'</span>
              <span class="code-keyword">WHERE</span> status = <span class="code-string">'pending'</span> 
                <span class="code-keyword">AND</span> order_date = <span class="code-keyword">CURDATE</span>();
              
              <span class="code-keyword">SET</span> total_processed = <span class="code-keyword">ROW_COUNT</span>();
              
              <span class="code-keyword">INSERT INTO</span> order_log (action, record_count, created_at)
              <span class="code-keyword">VALUES</span> (<span class="code-string">'monthly_process'</span>, total_processed, <span class="code-keyword">NOW</span>());
              
              <span class="code-keyword">COMMIT</span>;
            <span class="code-keyword">END</span>;
          <span class="code-keyword">END</span> //
          
          <span class="code-keyword">DELIMITER</span> ;
        </div>

        <div class="section-title">Procedure with Cursor</div>
        <div class="code-block">
          <span class="code-keyword">DELIMITER</span> //
          
          <span class="code-keyword">CREATE PROCEDURE</span> apply_loyalty_discount()
          <span class="code-keyword">BEGIN</span>
            <span class="code-keyword">DECLARE</span> done <span class="code-keyword">BOOLEAN DEFAULT FALSE</span>;
            <span class="code-keyword">DECLARE</span> cust_id <span class="code-keyword">INT</span>;
            <span class="code-keyword">DECLARE</span> cursor_customer <span class="code-keyword">CURSOR FOR</span>
              <span class="code-keyword">SELECT</span> customer_id
              <span class="code-keyword">FROM</span> customers
              <span class="code-keyword">WHERE</span> lifetime_value > <span class="code-number">5000</span>;
            
            <span class="code-keyword">DECLARE CONTINUE HANDLER FOR NOT FOUND</span>
              <span class="code-keyword">SET</span> done = <span class="code-keyword">TRUE</span>;
            
            <span class="code-keyword">OPEN</span> cursor_customer;
            read_loop: <span class="code-keyword">LOOP</span>
              <span class="code-keyword">FETCH</span> cursor_customer <span class="code-keyword">INTO</span> cust_id;
              <span class="code-keyword">IF</span> done <span class="code-keyword">THEN</span>
                <span class="code-keyword">LEAVE</span> read_loop;
              <span class="code-keyword">END IF</span>;
              
              <span class="code-keyword">UPDATE</span> orders
              <span class="code-keyword">SET</span> discount_percent = <span class="code-number">10</span>
              <span class="code-keyword">WHERE</span> customer_id = cust_id <span class="code-keyword">AND</span> status = <span class="code-string">'pending'</span>;
            <span class="code-keyword">END LOOP</span>;
            <span class="code-keyword">CLOSE</span> cursor_customer;
          <span class="code-keyword">END</span> //
          
          <span class="code-keyword">DELIMITER</span> ;
        </div>

        <div class="warning-box">
          ‚ö†Ô∏è Cursors process row-by-row and can be slower than set-based operations. Use set-based operations when possible.
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üî¢</span>
          <span class="card-title">User-Defined Functions (UDFs)</span>
        </div>
        
        <div class="section-title">Scalar Function</div>
        <div class="code-block">
          <span class="code-keyword">DELIMITER</span> //
          
          <span class="code-keyword">CREATE FUNCTION</span> calculate_order_discount(order_total <span class="code-keyword">DECIMAL</span>(<span class="code-number">12</span>, <span class="code-number">2</span>))
          <span class="code-keyword">RETURNS DECIMAL</span>(<span class="code-number">12</span>, <span class="code-number">2</span>)
          <span class="code-keyword">DETERMINISTIC</span>
          <span class="code-keyword">READS SQL DATA</span>
          <span class="code-keyword">BEGIN</span>
            <span class="code-keyword">DECLARE</span> discount <span class="code-keyword">DECIMAL</span>(<span class="code-number">12</span>, <span class="code-number">2</span>);
            
            <span class="code-keyword">IF</span> order_total > <span class="code-number">10000</span> <span class="code-keyword">THEN</span>
              <span class="code-keyword">SET</span> discount = order_total * <span class="code-number">0.15</span>;
            <span class="code-keyword">ELSEIF</span> order_total > <span class="code-number">5000</span> <span class="code-keyword">THEN</span>
              <span class="code-keyword">SET</span> discount = order_total * <span class="code-number">0.10</span>;
            <span class="code-keyword">ELSEIF</span> order_total > <span class="code-number">1000</span> <span class="code-keyword">THEN</span>
              <span class="code-keyword">SET</span> discount = order_total * <span class="code-number">0.05</span>;
            <span class="code-keyword">ELSE</span>
              <span class="code-keyword">SET</span> discount = <span class="code-number">0</span>;
            <span class="code-keyword">END IF</span>;
            
            <span class="code-keyword">RETURN</span> discount;
          <span class="code-keyword">END</span> //
          
          <span class="code-keyword">DELIMITER</span> ;
          
          <span class="code-comment">-- Use in SELECT</span>
          <span class="code-keyword">SELECT</span> 
            order_id,
            total_amount,
            calculate_order_discount(total_amount) <span class="code-keyword">as</span> discount
          <span class="code-keyword">FROM</span> orders;
        </div>

        <div class="section-title">Function with Multiple Logic</div>
        <div class="code-block">
          <span class="code-keyword">DELIMITER</span> //
          
          <span class="code-keyword">CREATE FUNCTION</span> get_customer_segment(lifetime_value <span class="code-keyword">DECIMAL</span>(<span class="code-number">12</span>, <span class="code-number">2</span>))
          <span class="code-keyword">RETURNS VARCHAR</span>(<span class="code-number">20</span>)
          <span class="code-keyword">DETERMINISTIC</span>
          <span class="code-keyword">READS SQL DATA</span>
          <span class="code-keyword">BEGIN</span>
            <span class="code-keyword">DECLARE</span> segment <span class="code-keyword">VARCHAR</span>(<span class="code-number">20</span>);
            
            <span class="code-keyword">CASE</span>
              <span class="code-keyword">WHEN</span> lifetime_value > <span class="code-number">10000</span> <span class="code-keyword">THEN</span>
                <span class="code-keyword">SET</span> segment = <span class="code-string">'VIP'</span>;
              <span class="code-keyword">WHEN</span> lifetime_value > <span class="code-number">5000</span> <span class="code-keyword">THEN</span>
                <span class="code-keyword">SET</span> segment = <span class="code-string">'Gold'</span>;
              <span class="code-keyword">WHEN</span> lifetime_value > <span class="code-number">1000</span> <span class="code-keyword">THEN</span>
                <span class="code-keyword">SET</span> segment = <span class="code-string">'Silver'</span>;
              <span class="code-keyword">ELSE</span>
                <span class="code-keyword">SET</span> segment = <span class="code-string">'Bronze'</span>;
            <span class="code-keyword">END CASE</span>;
            
            <span class="code-keyword">RETURN</span> segment;
          <span class="code-keyword">END</span> //
          
          <span class="code-keyword">DELIMITER</span> ;
          
          <span class="code-comment">-- Use in WHERE clause</span>
          <span class="code-keyword">SELECT</span> 
            customer_id,
            email,
            lifetime_value,
            get_customer_segment(lifetime_value) <span class="code-keyword">as</span> segment
          <span class="code-keyword">FROM</span> (
            <span class="code-keyword">SELECT</span> 
              c.customer_id,
              c.email,
              <span class="code-keyword">SUM</span>(o.total_amount) <span class="code-keyword">as</span> lifetime_value
            <span class="code-keyword">FROM</span> customers c
            <span class="code-keyword">LEFT JOIN</span> orders o <span class="code-keyword">ON</span> c.customer_id = o.customer_id
            <span class="code-keyword">GROUP BY</span> c.customer_id, c.email
          ) customer_stats
          <span class="code-keyword">WHERE</span> get_customer_segment(lifetime_value) = <span class="code-string">'VIP'</span>;
        </div>

        <div class="info-box">
          üí° <strong>Function Characteristics:</strong><br>
          ‚Ä¢ <strong>DETERMINISTIC:</strong> Same input always produces same output<br>
          ‚Ä¢ <strong>READS SQL DATA:</strong> Reads but doesn't modify data<br>
          ‚Ä¢ Can be used in SELECT, WHERE, and ORDER BY clauses
        </div>
      </div>
    </div>

    <!-- Triggers -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">‚ö°</span>
          <span class="card-title">Triggers - Data Validation</span>
        </div>
        
        <div class="code-block">
          <span class="code-keyword">CREATE TRIGGER</span> validate_order_before_insert
          <span class="code-keyword">BEFORE INSERT ON</span> orders
          <span class="code-keyword">FOR EACH ROW</span>
          <span class="code-keyword">BEGIN</span>
            <span class="code-keyword">IF</span> NEW.total_amount <= <span class="code-number">0</span> <span class="code-keyword">THEN</span>
              <span class="code-keyword">SIGNAL SQLSTATE</span> <span class="code-string">'45000'</span>
                <span class="code-keyword">SET MESSAGE_TEXT</span> = <span class="code-string">'Order amount must be positive'</span>;
            <span class="code-keyword">END IF</span>;
            
            <span class="code-keyword">IF</span> NEW.order_date > <span class="code-keyword">NOW</span>() <span class="code-keyword">THEN</span>
              <span class="code-keyword">SIGNAL SQLSTATE</span> <span class="code-string">'45000'</span>
                <span class="code-keyword">SET MESSAGE_TEXT</span> = <span class="code-string">'Order date cannot be in future'</span>;
            <span class="code-keyword">END IF</span>;
            
            <span class="code-comment">-- Set default status</span>
            <span class="code-keyword">SET</span> NEW.status = <span class="code-keyword">COALESCE</span>(NEW.status, <span class="code-string">'pending'</span>);
          <span class="code-keyword">END</span>;
        </div>

        <div class="section-title">AFTER INSERT Trigger (Audit Trail)</div>
        <div class="code-block">
          <span class="code-keyword">CREATE TRIGGER</span> log_order_creation
          <span class="code-keyword">AFTER INSERT ON</span> orders
          <span class="code-keyword">FOR EACH ROW</span>
          <span class="code-keyword">BEGIN</span>
            <span class="code-keyword">INSERT INTO</span> audit_log (
              table_name,
              operation,
              record_id,
              details,
              created_at
            ) <span class="code-keyword">VALUES</span> (
              <span class="code-string">'orders'</span>,
              <span class="code-string">'INSERT'</span>,
              NEW.order_id,
              <span class="code-keyword">CONCAT</span>(<span class="code-string">'New order from customer '</span>, NEW.customer_id),
              <span class="code-keyword">NOW</span>()
            );
          <span class="code-keyword">END</span>;
        </div>

        <div class="tip-box">
          ‚úÖ <strong>Trigger Timing:</strong><br>
          ‚Ä¢ <strong>BEFORE:</strong> Validate data, modify values<br>
          ‚Ä¢ <span class="code-keyword"><strong>AFTER:</strong> Audit trails, cascading updates
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üìù</span>
          <span class="card-title">More Trigger Examples</span>
        </div>
        
        <div class="section-title">BEFORE UPDATE (Track Changes)</div>
        <div class="code-block">
          <span class="code-keyword">CREATE TRIGGER</span> track_order_status_change
          <span class="code-keyword">BEFORE UPDATE ON</span> orders
          <span class="code-keyword">FOR EACH ROW</span>
          <span class="code-keyword">BEGIN</span>
            <span class="code-keyword">IF</span> OLD.status != NEW.status <span class="code-keyword">THEN</span>
              <span class="code-keyword">INSERT INTO</span> order_status_history (
                order_id,
                old_status,
                new_status,
                changed_at
              ) <span class="code-keyword">VALUES</span> (
                OLD.order_id,
                OLD.status,
                NEW.status,
                <span class="code-keyword">NOW</span>()
              );
            <span class="code-keyword">END IF</span>;
          <span class="code-keyword">END</span>;
        </div>

        <div class="section-title">AFTER DELETE (Soft Deletes)</div>
        <div class="code-block">
          <span class="code-comment">-- First add soft delete column</span>
          <span class="code-keyword">ALTER TABLE</span> customers <span class="code-keyword">ADD COLUMN</span> deleted_at <span class="code-keyword">TIMESTAMP NULL</span>;
          
          <span class="code-keyword">CREATE TRIGGER</span> soft_delete_customer
          <span class="code-keyword">BEFORE DELETE ON</span> customers
          <span class="code-keyword">FOR EACH ROW</span>
          <span class="code-keyword">BEGIN</span>
            <span class="code-comment">-- Instead of deleting, use soft delete with trigger</span>
            <span class="code-keyword">UPDATE</span> customers
            <span class="code-keyword">SET</span> deleted_at = <span class="code-keyword">NOW</span>()
            <span class="code-keyword">WHERE</span> customer_id = OLD.customer_id;
            
            <span class="code-comment">-- Prevent actual deletion</span>
            <span class="code-keyword">SIGNAL SQLSTATE</span> <span class="code-string">'45000'</span>
              <span class="code-keyword">SET MESSAGE_TEXT</span> = <span class="code-string">'Use UPDATE to soft delete'</span>;
          <span class="code-keyword">END</span>;
        </div>

        <div class="section-title">Trigger for Cascading Updates</div>
        <div class="code-block">
          <span class="code-comment">-- Update order count when new order inserted</span>
          <span class="code-keyword">CREATE TRIGGER</span> update_customer_order_count
          <span class="code-keyword">AFTER INSERT ON</span> orders
          <span class="code-keyword">FOR EACH ROW</span>
          <span class="code-keyword">BEGIN</span>
            <span class="code-keyword">UPDATE</span> customers
            <span class="code-keyword">SET</span> order_count = (<span class="code-keyword">SELECT COUNT</span>(*) <span class="code-keyword">FROM</span> orders <span class="code-keyword">WHERE</span> customer_id = NEW.customer_id)
            <span class="code-keyword">WHERE</span> customer_id = NEW.customer_id;
          <span class="code-keyword">END</span>;
        </div>

        <div class="warning-box">
          ‚ö†Ô∏è Triggers add overhead to DML operations. Use them judiciously and avoid complex logic in triggers.
        </div>
      </div>
    </div>

    <!-- Views -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üëÅÔ∏è</span>
          <span class="card-title">Views - Basic & Complex</span>
        </div>
        
        <div class="section-title">Simple View</div>
        <div class="code-block">
          <span class="code-comment">-- Create view for analyst convenience</span>
          <span class="code-keyword">CREATE VIEW</span> customer_order_summary <span class="code-keyword">AS</span>
          <span class="code-keyword">SELECT</span> 
            c.customer_id,
            c.email,
            <span class="code-keyword">COUNT</span>(o.order_id) <span class="code-keyword">as</span> total_orders,
            <span class="code-keyword">SUM</span>(o.total_amount) <span class="code-keyword">as</span> lifetime_value,
            <span class="code-keyword">MAX</span>(o.order_date) <span class="code-keyword">as</span> last_order_date,
            <span class="code-keyword">AVG</span>(o.total_amount) <span class="code-keyword">as</span> avg_order_value
          <span class="code-keyword">FROM</span> customers c
          <span class="code-keyword">LEFT JOIN</span> orders o <span class="code-keyword">ON</span> c.customer_id = o.customer_id
          <span class="code-keyword">GROUP BY</span> c.customer_id, c.email;
          
          <span class="code-comment">-- Query the view</span>
          <span class="code-keyword">SELECT</span> * <span class="code-keyword">FROM</span> customer_order_summary
          <span class="code-keyword">WHERE</span> lifetime_value > <span class="code-number">5000</span>
          <span class="code-keyword">ORDER BY</span> lifetime_value <span class="code-keyword">DESC</span>;
        </div>

        <div class="section-title">Complex View with JOINs</div>
        <div class="code-block">
          <span class="code-keyword">CREATE VIEW</span> detailed_order_view <span class="code-keyword">AS</span>
          <span class="code-keyword">SELECT</span> 
            o.order_id,
            c.customer_id,
            c.email,
            p.product_name,
            oi.quantity,
            oi.unit_price,
            (oi.quantity * oi.unit_price) <span class="code-keyword">as</span> line_total,
            o.order_date,
            o.status
          <span class="code-keyword">FROM</span> orders o
          <span class="code-keyword">JOIN</span> customers c <span class="code-keyword">ON</span> o.customer_id = c.customer_id
          <span class="code-keyword">JOIN</span> order_items oi <span class="code-keyword">ON</span> o.order_id = oi.order_id
          <span class="code-keyword">JOIN</span> products p <span class="code-keyword">ON</span> oi.product_id = p.product_id;
          
          <span class="code-comment">-- Use for reporting</span>
          <span class="code-keyword">SELECT</span> 
            email,
            product_name,
            <span class="code-keyword">SUM</span>(quantity) <span class="code-keyword">as</span> total_ordered,
            <span class="code-keyword">SUM</span>(line_total) <span class="code-keyword">as</span> revenue
          <span class="code-keyword">FROM</span> detailed_order_view
          <span class="code-keyword">WHERE</span> status = <span class="code-string">'delivered'</span>
          <span class="code-keyword">GROUP BY</span> email, product_name
          <span class="code-keyword">ORDER BY</span> revenue <span class="code-keyword">DESC</span>;
        </div>

        <div class="info-box">
          üí° Views provide:<br>
          ‚Ä¢ Simplified query interface<br>
          ‚Ä¢ Data abstraction and security<br>
          ‚Ä¢ Reusable complex queries<br>
          ‚Ä¢ Consistent business logic
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">‚úèÔ∏è</span>
          <span class="card-title">Updatable Views</span>
        </div>
        
        <div class="code-block">
          <span class="code-comment">-- View that supports INSERT/UPDATE operations</span>
          <span class="code-keyword">CREATE VIEW</span> orders_pending <span class="code-keyword">AS</span>
          <span class="code-keyword">SELECT</span> 
            order_id,
            customer_id,
            order_date,
            total_amount
          <span class="code-keyword">FROM</span> orders
          <span class="code-keyword">WHERE</span> status = <span class="code-string">'pending'</span>;
          
          <span class="code-comment">-- Can INSERT/UPDATE through view</span>
          <span class="code-keyword">UPDATE</span> orders_pending
          <span class="code-keyword">SET</span> total_amount = total_amount * <span class="code-number">1.05</span>
          <span class="code-keyword">WHERE</span> order_id = <span class="code-number">10</span>;
        </div>

        <div class="section-title">Materialized View Pattern</div>
        <div class="code-block">
          <span class="code-comment">-- Create summary table (pseudo-materialized view)</span>
          <span class="code-keyword">CREATE TABLE</span> monthly_sales_materialized <span class="code-keyword">AS</span>
          <span class="code-keyword">SELECT</span> 
            <span class="code-keyword">DATE_FORMAT</span>(o.order_date, <span class="code-string">'%Y-%m'</span>) <span class="code-keyword">as</span> report_month,
            c.customer_id,
            c.email,
            <span class="code-keyword">COUNT</span>(o.order_id) <span class="code-keyword">as</span> order_count,
            <span class="code-keyword">SUM</span>(o.total_amount) <span class="code-keyword">as</span> monthly_revenue
          <span class="code-keyword">FROM</span> orders o
          <span class="code-keyword">JOIN</span> customers c <span class="code-keyword">ON</span> o.customer_id = c.customer_id
          <span class="code-keyword">GROUP BY</span> <span class="code-keyword">DATE_FORMAT</span>(o.order_date, <span class="code-string">'%Y-%m'</span>), c.customer_id, c.email;
          
          <span class="code-comment">-- Create index</span>
          <span class="code-keyword">CREATE INDEX</span> idx_monthly_sales_month <span class="code-keyword">ON</span> monthly_sales_materialized(report_month);
          
          <span class="code-comment">-- Refresh procedure</span>
          <span class="code-keyword">DELIMITER</span> //
          <span class="code-keyword">CREATE PROCEDURE</span> refresh_monthly_sales()
          <span class="code-keyword">BEGIN</span>
            <span class="code-keyword">TRUNCATE TABLE</span> monthly_sales_materialized;
            <span class="code-keyword">INSERT INTO</span> monthly_sales_materialized
            <span class="code-keyword">SELECT</span> 
              <span class="code-keyword">DATE_FORMAT</span>(o.order_date, <span class="code-string">'%Y-%m'</span>) <span class="code-keyword">as</span> report_month,
              c.customer_id,
              c.email,
              <span class="code-keyword">COUNT</span>(o.order_id) <span class="code-keyword">as</span> order_count,
              <span class="code-keyword">SUM</span>(o.total_amount) <span class="code-keyword">as</span> monthly_revenue
            <span class="code-keyword">FROM</span> orders o
            <span class="code-keyword">JOIN</span> customers c <span class="code-keyword">ON</span> o.customer_id = c.customer_id
            <span class="code-keyword">GROUP BY</span> <span class="code-keyword">DATE_FORMAT</span>(o.order_date, <span class="code-string">'%Y-%m'</span>), c.customer_id, c.email;
          <span class="code-keyword">END</span> //
          <span class="code-keyword">DELIMITER</span> ;
        </div>

        <div class="tip-box">
          ‚úÖ Materialized views provide excellent performance for complex aggregations that are queried frequently
        </div>
      </div>
    </div>

    <!-- Systems Engineering Examples -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üîß</span>
          <span class="card-title">Systems Engineering: Automated Backup</span>
        </div>
        
        <div class="code-block">
          <span class="code-keyword">DELIMITER</span> //
          
          <span class="code-keyword">CREATE PROCEDURE</span> automated_database_backup()
          <span class="code-keyword">BEGIN</span>
            <span class="code-keyword">DECLARE</span> backup_path <span class="code-keyword">VARCHAR</span>(<span class="code-number">255</span>);
            <span class="code-keyword">DECLARE</span> backup_filename <span class="code-keyword">VARCHAR</span>(<span class="code-number">255</span>);
            
            <span class="code-keyword">SET</span> backup_path = <span class="code-string">'/var/backups/mysql/'</span>;
            <span class="code-keyword">SET</span> backup_filename = <span class="code-keyword">CONCAT</span>(backup_path, <span class="code-string">'backup_'</span>, 
              <span class="code-keyword">DATE_FORMAT</span>(<span class="code-keyword">NOW</span>(), <span class="code-string">'%Y%m%d_%H%i%s'</span>), <span class="code-string">'.sql'</span>);
            
            <span class="code-comment">-- Log backup attempt</span>
            <span class="code-keyword">INSERT INTO</span> backup_log (backup_type, backup_file, status, started_at)
            <span class="code-keyword">VALUES</span> (<span class="code-string">'full'</span>, backup_filename, <span class="code-string">'started'</span>, <span class="code-keyword">NOW</span>());
            
            <span class="code-comment">-- Call system command (requires FILE privilege)</span>
            <span class="code-comment">-- SELECT CONCAT('mysqldump -u root -p database > ', backup_filename) INTO @cmd;</span>
            
            <span class="code-comment">-- Update log</span>
            <span class="code-keyword">UPDATE</span> backup_log
            <span class="code-keyword">SET</span> status = <span class="code-string">'completed'</span>, completed_at = <span class="code-keyword">NOW</span>()
            <span class="code-keyword">WHERE</span> backup_file = backup_filename;
          <span class="code-keyword">END</span> //
          
          <span class="code-keyword">DELIMITER</span> ;
        </div>

        <div class="section-title">Health Check Procedure</div>
        <div class="code-block">
          <span class="code-keyword">DELIMITER</span> //
          
          <span class="code-keyword">CREATE PROCEDURE</span> check_database_health()
          <span class="code-keyword">BEGIN</span>
            <span class="code-keyword">DECLARE</span> table_count <span class="code-keyword">INT</span>;
            <span class="code-keyword">DECLARE</span> corrupted_tables <span class="code-keyword">INT</span>;
            
            <span class="code-comment">-- Count tables</span>
            <span class="code-keyword">SELECT COUNT</span>(*) <span class="code-keyword">INTO</span> table_count
            <span class="code-keyword">FROM</span> information_schema.tables
            <span class="code-keyword">WHERE</span> table_schema = <span class="code-keyword">DATABASE</span>();
            
            <span class="code-comment">-- Check for issues (simplified)</span>
            <span class="code-keyword">SELECT COUNT</span>(*) <span class="code-keyword">INTO</span> corrupted_tables
            <span class="code-keyword">FROM</span> information_schema.tables
            <span class="code-keyword">WHERE</span> table_schema = <span class="code-keyword">DATABASE</span>()
            <span class="code-keyword">AND</span> table_type = <span class="code-string">'BASE TABLE'</span>;
            
            <span class="code-keyword">INSERT INTO</span> health_log (
              check_time,
              table_count,
              status,
              details
            ) <span class="code-keyword">VALUES</span> (
              <span class="code-keyword">NOW</span>(),
              table_count,
              <span class="code-keyword">IF</span>(table_count > <span class="code-number">0</span>, <span class="code-string">'healthy'</span>, <span class="code-string">'warning'</span>),
              <span class="code-keyword">CONCAT</span>(<span class="code-string">'Found '</span>, table_count, <span class="code-string">' tables'</span>)
            );
          <span class="code-keyword">END</span> //
          
          <span class="code-keyword">DELIMITER</span> ;
        </div>

        <div class="tag">automation</div>
        <div class="tag">backup</div>
        <div class="tag">monitoring</div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üìã</span>
          <span class="card-title">Programmability Best Practices</span>
        </div>
        
        <table class="comparison-table">
          <tr>
            <th>Element</th>
            <th>Use When</th>
            <th>Benefits</th>
          </tr>
          <tr>
            <td><strong>Stored Procedures</strong></td>
            <td>Complex business logic, multiple operations</td>
            <td>Performance, security, code reuse</td>
          </tr>
          <tr>
            <td><strong>Functions</strong></td>
            <td>Calculations, data transformations</td>
            <td>Reusable in queries, encapsulation</td>
          </tr>
          <tr>
            <td><strong>Triggers</strong></td>
            <td>Automatic enforcement, auditing</td>
            <td>Data integrity, automation</td>
          </tr>
          <tr>
            <td><strong>Views</strong></td>
            <td>Simplify complex queries, security</td>
            <td>Abstraction, convenience</td>
          </tr>
        </table>

        <div class="section-title">Performance Considerations</div>
        <div class="highlight">
          ‚Ä¢ Keep procedures simple and focused<br>
          ‚Ä¢ Avoid cursors when set-based operations work<br>
          ‚Ä¢ Use transactions for data consistency<br>
          ‚Ä¢ Handle errors gracefully<br>
          ‚Ä¢ Document complex business logic
        </div>

        <div class="tag">best-practices</div>
        <div class="tag">performance</div>
      </div>
    </div>

    <!-- Learning Checklist -->
    <div class="grid">
      <div class="card full-width">
        <div class="card-header">
          <span class="card-icon">‚úÖ</span>
          <span class="card-title">Learning Checklist</span>
        </div>
        
        <div class="two-col">
          <div>
            <div class="list-item">Create stored procedures with IN/OUT parameters</div>
            <div class="list-item">Implement control flow in procedures (IF, CASE, LOOPS)</div>
            <div class="list-item">Build user-defined functions for business logic</div>
            <div class="list-item">Create triggers for data validation and auditing</div>
          </div>
          <div>
            <div class="list-item">Design updatable and read-only views</div>
            <div class="list-item">Implement materialized views for performance</div>
            <div class="list-item">Handle errors in procedures and functions</div>
            <div class="list-item">Use cursors for row-by-row processing when needed</div>
          </div>
        </div>

        <div class="tag">stored-procedures</div>
        <div class="tag">functions</div>
        <div class="tag">triggers</div>
        <div class="tag">views</div>
        <div class="tag">programmability</div>
      </div>
    </div>

    <div class="footer">
      <p>MySQL Cheat Sheet #5 - Programmability ‚Ä¢ Complete MySQL Knowledge Base</p>
    </div>
  </div>
</body>
</html>