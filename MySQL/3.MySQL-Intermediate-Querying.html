<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MySQL Cheat Sheet #3 - Intermediate Querying</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #064e3b 0%, #0f172a 100%);
      color: #fff;
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      border-radius: 15px;
    }
    .header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      color: #fff;
    }
    .header .subtitle {
      color: #fff;
      font-size: 1.1em;
      opacity: 0.9;
    }
    .badge {
      display: inline-block;
      background: rgba(0,0,0,0.3);
      color: #fff;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.85em;
      margin-top: 10px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    .card {
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(109,213,237,0.3);
    }
    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #6dd5ed;
    }
    .card-icon {
      font-size: 1.8em;
      margin-right: 12px;
    }
    .card-title {
      font-size: 1.3em;
      color: #6dd5ed;
    }
    .code-block {
      background: #0d1117;
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.85em;
      overflow-x: auto;
      border-left: 3px solid #6dd5ed;
    }
    .code-comment {
      color: #6a737d;
    }
    .code-keyword {
      color: #ff7b72;
    }
    .code-string {
      color: #a5d6ff;
    }
    .code-method {
      color: #d2a8ff;
    }
    .code-number {
      color: #79c0ff;
    }
    .code-prop {
      color: #7ee787;
    }
    .highlight {
      background: linear-gradient(135deg, rgba(33,147,176,0.2), rgba(109,213,237,0.2));
      padding: 15px;
      border-radius: 10px;
      margin: 10px 0;
    }
    .list-item {
      padding: 8px 0;
      padding-left: 20px;
      position: relative;
    }
    .list-item::before {
      content: "‚ñ∏";
      position: absolute;
      left: 0;
      color: #6dd5ed;
    }
    .tag {
      display: inline-block;
      background: rgba(109,213,237,0.2);
      color: #6dd5ed;
      padding: 3px 10px;
      border-radius: 5px;
      font-size: 0.8em;
      margin: 2px;
    }
    .tag-orange {
      background: rgba(243,156,18,0.2);
      color: #f39c12;
    }
    .tag-red {
      background: rgba(231,76,60,0.2);
      color: #e74c3c;
    }
    .tag-green {
      background: rgba(46,204,113,0.2);
      color: #2ecc71;
    }
    .tag-purple {
      background: rgba(155,89,182,0.2);
      color: #9b59b6;
    }
    .full-width {
      grid-column: 1 / -1;
    }
    .info-box {
      background: rgba(52,152,219,0.1);
      border-left: 3px solid #3498db;
      padding: 12px;
      border-radius: 0 8px 8px 0;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .warning-box {
      background: rgba(231,76,60,0.1);
      border-left: 3px solid #e74c3c;
      padding: 12px;
      border-radius: 0 8px 8px 0;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .tip-box {
      background: rgba(46,204,113,0.1);
      border-left: 3px solid #2ecc71;
      padding: 12px;
      border-radius: 0 8px 8px 0;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .section-title {
      color: #6dd5ed;
      font-size: 1.1em;
      margin: 15px 0 10px 0;
      padding-bottom: 5px;
      border-bottom: 1px dashed rgba(109,213,237,0.3);
    }
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .comparison-table th, .comparison-table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .comparison-table th {
      background: rgba(109,213,237,0.2);
      color: #6dd5ed;
    }
    .comparison-table tr:hover {
      background: rgba(255,255,255,0.05);
    }
    .flex-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 0;
    }
    .footer {
      text-align: center;
      padding: 20px;
      color: rgba(255,255,255,0.5);
      font-size: 0.9em;
    }
    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    @media (max-width: 768px) {
      .two-col {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üîó MySQL Cheat Sheet #3</h1>
      <div class="subtitle">Intermediate Querying ‚Äî JOINs, Subqueries, CTEs, Window Functions</div>
      <div class="badge">üìä JOINs ‚Ä¢ CTEs ‚Ä¢ Window Functions ‚Ä¢ Analytics</div>
    </div>

    <!-- JOIN Operations Overview -->
    <div class="grid">
      <div class="card full-width">
        <div class="card-header">
          <span class="card-icon">üîó</span>
          <span class="card-title">JOIN Operations Overview</span>
        </div>
        
        <table class="comparison-table">
          <tr>
            <th>JOIN Type</th>
            <th>Returns</th>
            <th>When to Use</th>
          </tr>
          <tr>
            <td><strong>INNER JOIN</strong></td>
            <td>Only matching rows from both tables</td>
            <td>When you need data that exists in both tables</td>
          </tr>
          <tr>
            <td><strong>LEFT JOIN</strong></td>
            <td>All rows from left table, matching from right</td>
            <td>When you need all records from primary table</td>
          </tr>
          <tr>
            <td><strong>RIGHT JOIN</strong></td>
            <td>All rows from right table, matching from left</td>
            <td>When you need all records from secondary table</td>
          </tr>
          <tr>
            <td><strong>FULL OUTER JOIN</strong></td>
            <td>All rows from both tables (MySQL uses UNION)</td>
            <td>When you need all records from both tables</td>
          </tr>
          <tr>
            <td><strong>CROSS JOIN</strong></td>
            <td>Cartesian product of both tables</td>
            <td>For generating combinations (use carefully)</td>
          </tr>
        </table>
      </div>
    </div>

    <!-- INNER JOIN -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üîó</span>
          <span class="card-title">INNER JOIN</span>
        </div>
        
        <div class="highlight">
          Returns only matching rows from both tables. This is the most common JOIN type.
        </div>

        <div class="code-block">
<span class="code-comment">-- Example: Get orders with customer names</span>
<span class="code-keyword">SELECT</span> 
    o.order_id,
    c.customer_id,
    c.email,
    o.order_date,
    o.total_amount
<span class="code-keyword">FROM</span> 
    orders o
<span class="code-keyword">INNER JOIN</span> 
    customers c <span class="code-keyword">ON</span> o.customer_id = c.customer_id;
        </div>

        <div class="code-block">
<span class="code-comment">-- Multiple joins (formatted for clarity)</span>
<span class="code-keyword">SELECT</span> 
    o.order_id,
    c.email,
    p.product_name,
    oi.quantity,
    oi.unit_price
<span class="code-keyword">FROM</span> 
    orders o
<span class="code-keyword">INNER JOIN</span> 
    customers c <span class="code-keyword">ON</span> o.customer_id = c.customer_id
<span class="code-keyword">INNER JOIN</span> 
    order_items oi <span class="code-keyword">ON</span> o.order_id = oi.order_id
<span class="code-keyword">INNER JOIN</span> 
    products p <span class="code-keyword">ON</span> oi.product_id = p.product_id;
        </div>

        <div class="tip-box">
          ‚úÖ <strong>INNER JOIN</strong> is the default. You can write just <code>JOIN</code> instead of <code>INNER JOIN</code>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">‚¨ÖÔ∏è</span>
          <span class="card-title">LEFT JOIN</span>
        </div>
        
        <div class="highlight">
          Returns all rows from the left table, and matching rows from the right table. NULL for non-matching right rows.
        </div>

        <div class="code-block">
<span class="code-comment">-- Find customers who have never placed an order</span>
<span class="code-keyword">SELECT</span> 
    c.customer_id,
    c.email,
    o.order_id,
    o.order_date
<span class="code-keyword">FROM</span> 
    customers c
<span class="code-keyword">LEFT JOIN</span> 
    orders o <span class="code-keyword">ON</span> c.customer_id = o.customer_id
<span class="code-keyword">WHERE</span> 
    o.order_id <span class="code-keyword">IS NULL</span>;
        </div>

        <div class="code-block">
<span class="code-comment">-- Count orders per customer (including those with no orders)</span>
<span class="code-keyword">SELECT</span> 
    c.customer_id,
    c.email,
    <span class="code-keyword">COUNT</span>(o.order_id) <span class="code-keyword">as</span> total_orders
<span class="code-keyword">FROM</span> 
    customers c
<span class="code-keyword">LEFT JOIN</span> 
    orders o <span class="code-keyword">ON</span> c.customer_id = o.customer_id
<span class="code-keyword">GROUP BY</span> 
    c.customer_id, c.email
<span class="code-keyword">ORDER BY</span> 
    total_orders <span class="code-keyword">DESC</span>;
        </div>

        <div class="info-box">
          üí° Use <strong>LEFT JOIN</strong> when you need all records from the primary table, even if they don't have related records in the secondary table.
        </div>
      </div>
    </div>

    <!-- RIGHT JOIN and FULL JOIN -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">‚û°Ô∏è</span>
          <span class="card-title">RIGHT JOIN & FULL JOIN</span>
        </div>
        
        <div class="code-block">
<span class="code-comment">-- Find products that haven't been ordered yet</span>
<span class="code-keyword">SELECT</span> 
    p.product_id,
    p.product_name,
    oi.order_item_id
<span class="code-keyword">FROM</span> 
    order_items oi
<span class="code-keyword">RIGHT JOIN</span> 
    products p <span class="code-keyword">ON</span> oi.product_id = p.product_id
<span class="code-keyword">WHERE</span> 
    oi.order_item_id <span class="code-keyword">IS NULL</span>;
        </div>

        <div class="code-block">
<span class="code-comment">-- MySQL doesn't support FULL JOIN natively, use UNION instead</span>
<span class="code-keyword">SELECT</span> 
    c.customer_id,
    c.email,
    o.order_id
<span class="code-keyword">FROM</span> 
    customers c
<span class="code-keyword">LEFT JOIN</span> 
    orders o <span class="code-keyword">ON</span> c.customer_id = o.customer_id
<span class="code-keyword">UNION</span>
<span class="code-keyword">SELECT</span> 
    c.customer_id,
    c.email,
    o.order_id
<span class="code-keyword">FROM</span> 
    customers c
<span class="code-keyword">RIGHT JOIN</span> 
    orders o <span class="code-keyword">ON</span> c.customer_id = o.customer_id;
        </div>

        <div class="code-block">
<span class="code-comment">-- CROSS JOIN: Generate all combinations (use cautiously)</span>
<span class="code-keyword">SELECT</span> 
    p.product_id,
    c.category_id
<span class="code-keyword">FROM</span> 
    products p
<span class="code-keyword">CROSS JOIN</span> 
    categories c
<span class="code-keyword">LIMIT</span> <span class="code-number">100</span>;
        </div>

        <div class="warning-box">
          ‚ö†Ô∏è <strong>CROSS JOIN</strong> creates Cartesian product. With 1000 rows in each table, result = 1,000,000 rows!
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üîÑ</span>
          <span class="card-title">Self JOIN</span>
        </div>
        
        <div class="highlight">
          Join a table to itself to query hierarchical or recursive relationships.
        </div>

        <div class="code-block">
<span class="code-comment">-- Find employees and their managers</span>
<span class="code-keyword">SELECT</span> 
    e.employee_id,
    e.employee_name,
    m.employee_id <span class="code-keyword">as</span> manager_id,
    m.employee_name <span class="code-keyword">as</span> manager_name
<span class="code-keyword">FROM</span> 
    employees e
<span class="code-keyword">LEFT JOIN</span> 
    employees m <span class="code-keyword">ON</span> e.manager_id = m.employee_id;
        </div>

        <div class="code-block">
<span class="code-comment">-- Find products with similar names</span>
<span class="code-keyword">SELECT</span> 
    a.product_id <span class="code-keyword">as</span> product_a,
    b.product_id <span class="code-keyword">as</span> product_b,
    a.product_name
<span class="code-keyword">FROM</span> 
    products a
<span class="code-keyword">JOIN</span> 
    products b <span class="code-keyword">ON</span> a.product_name = b.product_name
<span class="code-keyword">WHERE</span> 
    a.product_id < b.product_id;
        </div>

        <div class="tip-box">
          ‚úÖ Self JOINs use table aliases to distinguish between the two instances of the same table
        </div>
      </div>
    </div>

    <!-- Subqueries -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üîç</span>
          <span class="card-title">Scalar & Correlated Subqueries</span>
        </div>
        
        <div class="section-title">Scalar Subquery (Single Value)</div>
        <div class="code-block">
          <span class="code-comment">-- Find products more expensive than average</span>
          <span class="code-keyword">SELECT</span> 
            product_id,
            product_name,
            price
          <span class="code-keyword">FROM</span> products
          <span class="code-keyword">WHERE</span> price > (<span class="code-keyword">SELECT AVG</span>(price) <span class="code-keyword">FROM</span> products);
        </div>

        <div class="section-title">Correlated Subquery (References Outer Query)</div>
        <div class="code-block">
<span class="code-comment">-- For each customer, find their most recent order</span>
<span class="code-keyword">SELECT</span> 
    c.customer_id,
    c.email,
    o.order_id,
    o.order_date
<span class="code-keyword">FROM</span> 
    customers c
<span class="code-keyword">JOIN</span> 
    orders o <span class="code-keyword">ON</span> c.customer_id = o.customer_id
<span class="code-keyword">WHERE</span> 
    o.order_date = (
        <span class="code-keyword">SELECT MAX</span>(order_date)
        <span class="code-keyword">FROM</span> orders o2
        <span class="code-keyword">WHERE</span> o2.customer_id = c.customer_id
    );
        </div>

        <div class="info-box">
          üí° <strong>Correlated vs Non-correlated:</strong><br>
          ‚Ä¢ Correlated: Executes once for each row in outer query<br>
          ‚Ä¢ Non-correlated: Executes once, result used by outer query
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üìã</span>
          <span class="card-title">IN / EXISTS Subqueries</span>
        </div>
        
        <div class="code-block">
<span class="code-comment">-- Find products that have been ordered</span>
<span class="code-keyword">SELECT</span> 
    product_id,
    product_name
<span class="code-keyword">FROM</span> 
    products
<span class="code-keyword">WHERE</span> 
    product_id <span class="code-keyword">IN</span> (
        <span class="code-keyword">SELECT DISTINCT</span> product_id
        <span class="code-keyword">FROM</span> order_items
    );
        </div>

        <div class="code-block">
<span class="code-comment">-- Alternative using EXISTS</span>
<span class="code-keyword">SELECT</span> 
    product_id,
    product_name
<span class="code-keyword">FROM</span> 
    products p
<span class="code-keyword">WHERE EXISTS</span> (
    <span class="code-keyword">SELECT</span> <span class="code-number">1</span>
    <span class="code-keyword">FROM</span> order_items oi
    <span class="code-keyword">WHERE</span> oi.product_id = p.product_id
);
        </div>

        <div class="code-block">
<span class="code-comment">-- Find products never ordered</span>
<span class="code-keyword">SELECT</span> 
    product_id,
    product_name
<span class="code-keyword">FROM</span> 
    products
<span class="code-keyword">WHERE</span> 
    product_id <span class="code-keyword">NOT IN</span> (
        <span class="code-keyword">SELECT DISTINCT</span> product_id
        <span class="code-keyword">FROM</span> order_items
    );
        </div>

        <div class="tip-box">
          ‚úÖ <strong>EXISTS vs IN:</strong> EXISTS is often faster for subqueries that return many rows, as it stops when it finds the first match
        </div>
      </div>
    </div>

    <!-- CTEs -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üìä</span>
          <span class="card-title">Common Table Expressions (CTEs)</span>
        </div>
        
        <div class="highlight">
          CTEs create temporary result sets that can be referenced within SELECT, INSERT, UPDATE, or DELETE statements.
        </div>

        <div class="section-title">Simple CTE</div>
        <div class="code-block">
<span class="code-keyword">WITH</span> high_value_orders <span class="code-keyword">AS</span> (
    <span class="code-keyword">SELECT</span> 
        order_id,
        customer_id,
        total_amount,
        order_date
    <span class="code-keyword">FROM</span> orders
    <span class="code-keyword">WHERE</span> total_amount > <span class="code-number">1000</span>
)
<span class="code-keyword">SELECT</span> 
    hvo.order_id,
    c.email,
    hvo.total_amount
<span class="code-keyword">FROM</span> high_value_orders hvo
<span class="code-keyword">JOIN</span> customers c <span class="code-keyword">ON</span> hvo.customer_id = c.customer_id
<span class="code-keyword">ORDER BY</span> hvo.total_amount <span class="code-keyword">DESC</span>;
        </div>

        <div class="section-title">Multiple CTEs</div>
        <div class="code-block">
          <span class="code-keyword">WITH</span> customer_totals <span class="code-keyword">AS</span> (
            <span class="code-keyword">SELECT</span> 
              customer_id,
              <span class="code-keyword">COUNT</span>(*) <span class="code-keyword">as</span> order_count,
              <span class="code-keyword">SUM</span>(total_amount) <span class="code-keyword">as</span> total_spent,
              <span class="code-keyword">AVG</span>(total_amount) <span class="code-keyword">as</span> avg_order_value
            <span class="code-keyword">FROM</span> orders
            <span class="code-keyword">GROUP BY</span> customer_id
          ),
          high_value_customers <span class="code-keyword">AS</span> (
            <span class="code-keyword">SELECT</span> *
            <span class="code-keyword">FROM</span> customer_totals
            <span class="code-keyword">WHERE</span> total_spent > <span class="code-number">5000</span>
          )
          <span class="code-keyword">SELECT</span> 
            c.customer_id,
            c.email,
            hvc.order_count,
            hvc.total_spent,
            hvc.avg_order_value
          <span class="code-keyword">FROM</span> high_value_customers hvc
          <span class="code-keyword">JOIN</span> customers c <span class="code-keyword">ON</span> hvc.customer_id = c.customer_id
          <span class="code-keyword">ORDER BY</span> hvc.total_spent <span class="code-keyword">DESC</span>;
        </div>

        <div class="tip-box">
          ‚úÖ CTEs improve readability and can be reused multiple times in the main query
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üîÑ</span>
          <span class="card-title">Recursive CTEs</span>
        </div>
        
        <div class="highlight">
          Recursive CTEs can traverse hierarchical data like organizational charts or category trees.
        </div>

        <div class="code-block">
          <span class="code-comment">-- Generate date range for reporting</span>
          <span class="code-keyword">WITH RECURSIVE</span> dates <span class="code-keyword">AS</span> (
            <span class="code-keyword">SELECT</span> <span class="code-string">'2024-01-01'</span> <span class="code-keyword">as</span> report_date
            <span class="code-keyword">UNION ALL</span>
            <span class="code-keyword">SELECT</span> <span class="code-keyword">DATE_ADD</span>(report_date, <span class="code-keyword">INTERVAL</span> <span class="code-number">1</span> <span class="code-keyword">DAY</span>)
            <span class="code-keyword">FROM</span> dates
            <span class="code-keyword">WHERE</span> report_date < <span class="code-string">'2024-01-31'</span>
          )
          <span class="code-keyword">SELECT</span> 
            d.report_date,
            <span class="code-keyword">COUNT</span>(o.order_id) <span class="code-keyword">as</span> daily_orders,
            <span class="code-keyword">SUM</span>(o.total_amount) <span class="code-keyword">as</span> daily_revenue
          <span class="code-keyword">FROM</span> dates d
          <span class="code-keyword">LEFT JOIN</span> orders o <span class="code-keyword">ON</span> <span class="code-keyword">DATE</span>(o.order_date) = d.report_date
          <span class="code-keyword">GROUP BY</span> d.report_date
          <span class="code-keyword">ORDER BY</span> d.report_date;
        </div>

        <div class="code-block">
          <span class="code-comment">-- Find organizational hierarchy</span>
          <span class="code-keyword">WITH RECURSIVE</span> employee_hierarchy <span class="code-keyword">AS</span> (
            <span class="code-keyword">SELECT</span> 
              employee_id,
              employee_name,
              manager_id,
              <span class="code-number">1</span> <span class="code-keyword">as</span> hierarchy_level
            <span class="code-keyword">FROM</span> employees
            <span class="code-keyword">WHERE</span> manager_id <span class="code-keyword">IS NULL</span>  <span class="code-comment">-- Start from top</span>
            
            <span class="code-keyword">UNION ALL</span>
            
            <span class="code-keyword">SELECT</span> 
              e.employee_id,
              e.employee_name,
              e.manager_id,
              eh.hierarchy_level + <span class="code-number">1</span>
            <span class="code-keyword">FROM</span> employees e
            <span class="code-keyword">JOIN</span> employee_hierarchy eh <span class="code-keyword">ON</span> e.manager_id = eh.employee_id
          )
          <span class="code-keyword">SELECT</span> * <span class="code-keyword">FROM</span> employee_hierarchy
          <span class="code-keyword">ORDER BY</span> hierarchy_level, employee_id;
        </div>

        <div class="info-box">
          üí° Recursive CTEs have two parts: <strong>anchor member</strong> (starting point) and <strong>recursive member</strong> (joins back to CTE)
        </div>
      </div>
    </div>

    <!-- Window Functions -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üìà</span>
          <span class="card-title">Window Functions - ROW_NUMBER, RANK, DENSE_RANK</span>
        </div>
        
        <div class="code-block">
          <span class="code-comment">-- Rank orders by value for each customer</span>
          <span class="code-keyword">SELECT</span> 
            order_id,
            customer_id,
            total_amount,
            <span class="code-keyword">ROW_NUMBER</span>() <span class="code-keyword">OVER</span> (
              <span class="code-keyword">PARTITION BY</span> customer_id 
              <span class="code-keyword">ORDER BY</span> total_amount <span class="code-keyword">DESC</span>
            ) <span class="code-keyword">as</span> order_rank
          <span class="code-keyword">FROM</span> orders;
        </div>

        <div class="code-block">
          <span class="code-comment">-- Show sales ranking with handling of ties</span>
          <span class="code-keyword">SELECT</span> 
            employee_id,
            employee_name,
            sales_amount,
            <span class="code-keyword">RANK</span>() <span class="code-keyword">OVER</span> (
              <span class="code-keyword">ORDER BY</span> sales_amount <span class="code-keyword">DESC</span>
            ) <span class="code-keyword">as</span> rank_with_gaps,
            <span class="code-keyword">DENSE_RANK</span>() <span class="code-keyword">OVER</span> (
              <span class="code-keyword">ORDER BY</span> sales_amount <span class="code-keyword">DESC</span>
            ) <span class="code-keyword">as</span> rank_dense
          <span class="code-keyword">FROM</span> employee_sales;
        </div>

        <table class="comparison-table">
          <tr>
            <th>Function</th>
            <th>Behavior with Ties</th>
          </tr>
          <tr>
            <td><code>ROW_NUMBER()</code></td>
            <td>Always unique, no gaps</td>
          </tr>
          <tr>
            <td><code>RANK()</code></td>
            <td>Same rank for ties, creates gaps</td>
          </tr>
          <tr>
            <td><code>DENSE_RANK()</code></td>
            <td>Same rank for ties, no gaps</td>
          </tr>
        </table>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üìä</span>
          <span class="card-title">Window Functions - Analytics</span>
        </div>
        
        <div class="section-title">Running Total</div>
        <div class="code-block">
          <span class="code-comment">-- Calculate running total of order amounts</span>
          <span class="code-keyword">SELECT</span> 
            order_id,
            order_date,
            total_amount,
            <span class="code-keyword">SUM</span>(total_amount) <span class="code-keyword">OVER</span> (
              <span class="code-keyword">ORDER BY</span> order_date
              <span class="code-keyword">ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW</span>
            ) <span class="code-keyword">as</span> running_total
          <span class="code-keyword">FROM</span> orders
          <span class="code-keyword">ORDER BY</span> order_date;
        </div>

        <div class="section-title">Moving Average</div>
        <div class="code-block">
          <span class="code-comment">-- Calculate 7-day moving average of revenue</span>
          <span class="code-keyword">SELECT</span> 
            order_date,
            total_amount,
            <span class="code-keyword">ROUND</span>(<span class="code-keyword">AVG</span>(total_amount) <span class="code-keyword">OVER</span> (
              <span class="code-keyword">ORDER BY</span> order_date
              <span class="code-keyword">ROWS BETWEEN 6 PRECEDING AND CURRENT ROW</span>
            ), <span class="code-number">2</span>) <span class="code-keyword">as</span> moving_avg_7day
          <span class="code-keyword">FROM</span> orders
          <span class="code-keyword">ORDER BY</span> order_date;
        </div>

        <div class="section-title">LAG and LEAD</div>
        <div class="code-block">
          <span class="code-comment">-- Compare current month sales with previous month</span>
          <span class="code-keyword">SELECT</span> 
            <span class="code-keyword">MONTH</span>(order_date) <span class="code-keyword">as</span> month,
            <span class="code-keyword">SUM</span>(total_amount) <span class="code-keyword">as</span> monthly_revenue,
            <span class="code-keyword">LAG</span>(<span class="code-keyword">SUM</span>(total_amount)) <span class="code-keyword">OVER</span> (
              <span class="code-keyword">ORDER BY</span> <span class="code-keyword">MONTH</span>(order_date)
            ) <span class="code-keyword">as</span> previous_month_revenue,
            <span class="code-keyword">ROUND</span>(((<span class="code-keyword">SUM</span>(total_amount) - <span class="code-keyword">LAG</span>(<span class="code-keyword">SUM</span>(total_amount)) <span class="code-keyword">OVER</span> (
              <span class="code-keyword">ORDER BY</span> <span class="code-keyword">MONTH</span>(order_date)
            )) / <span class="code-keyword">LAG</span>(<span class="code-keyword">SUM</span>(total_amount)) <span class="code-keyword">OVER</span> (
              <span class="code-keyword">ORDER BY</span> <span class="code-keyword">MONTH</span>(order_date)
            ) * <span class="code-number">100</span>), <span class="code-number">2</span>) <span class="code-keyword">as</span> growth_percentage
          <span class="code-keyword">FROM</span> orders
          <span class="code-keyword">WHERE</span> <span class="code-keyword">YEAR</span>(order_date) = <span class="code-number">2024</span>
          <span class="code-keyword">GROUP BY</span> <span class="code-keyword">MONTH</span>(order_date);
        </div>
      </div>
    </div>

    <!-- Complex Analytics -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üìä</span>
          <span class="card-title">Customer Segmentation Analysis</span>
        </div>
        
        <div class="code-block">
          <span class="code-keyword">WITH</span> customer_metrics <span class="code-keyword">AS</span> (
            <span class="code-keyword">SELECT</span> 
              c.customer_id,
              c.email,
              <span class="code-keyword">COUNT</span>(<span class="code-keyword">DISTINCT</span> o.order_id) <span class="code-keyword">as</span> total_orders,
              <span class="code-keyword">SUM</span>(o.total_amount) <span class="code-keyword">as</span> lifetime_value,
              <span class="code-keyword">MAX</span>(o.order_date) <span class="code-keyword">as</span> last_order_date,
              <span class="code-keyword">DATEDIFF</span>(<span class="code-keyword">NOW</span>(), <span class="code-keyword">MAX</span>(o.order_date)) <span class="code-keyword">as</span> days_since_last_order,
              <span class="code-keyword">AVG</span>(o.total_amount) <span class="code-keyword">as</span> avg_order_value
            <span class="code-keyword">FROM</span> customers c
            <span class="code-keyword">LEFT JOIN</span> orders o <span class="code-keyword">ON</span> c.customer_id = o.customer_id
            <span class="code-keyword">GROUP BY</span> c.customer_id, c.email
          )
          <span class="code-keyword">SELECT</span> 
            customer_id,
            email,
            total_orders,
            lifetime_value,
            last_order_date,
            days_since_last_order,
            <span class="code-keyword">CASE</span> 
              <span class="code-keyword">WHEN</span> lifetime_value > <span class="code-number">10000</span> <span class="code-keyword">THEN</span> <span class="code-string">'VIP'</span>
              <span class="code-keyword">WHEN</span> lifetime_value > <span class="code-number">5000</span> <span class="code-keyword">THEN</span> <span class="code-string">'Gold'</span>
              <span class="code-keyword">WHEN</span> total_orders >= <span class="code-number">5</span> <span class="code-keyword">THEN</span> <span class="code-string">'Silver'</span>
              <span class="code-keyword">ELSE</span> <span class="code-string">'Bronze'</span>
            <span class="code-keyword">END</span> <span class="code-keyword">as</span> customer_segment,
            <span class="code-keyword">CASE</span> 
              <span class="code-keyword">WHEN</span> days_since_last_order <= <span class="code-number">30</span> <span class="code-keyword">THEN</span> <span class="code-string">'Active'</span>
              <span class="code-keyword">WHEN</span> days_since_last_order <= <span class="code-number">90</span> <span class="code-keyword">THEN</span> <span class="code-string">'At Risk'</span>
              <span class="code-keyword">ELSE</span> <span class="code-string">'Inactive'</span>
            <span class="code-keyword">END</span> <span class="code-keyword">as</span> engagement_status
          <span class="code-keyword">FROM</span> customer_metrics
          <span class="code-keyword">ORDER BY</span> lifetime_value <span class="code-keyword">DESC</span>;
        </div>

        <div class="tag">analytics</div>
        <div class="tag">segmentation</div>
        <div class="tag">cte</div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üìà</span>
          <span class="card-title">Monthly Sales Analysis</span>
        </div>
        
        <div class="code-block">
          <span class="code-keyword">WITH</span> monthly_sales <span class="code-keyword">AS</span> (
            <span class="code-keyword">SELECT</span> 
              <span class="code-keyword">DATE_FORMAT</span>(o.order_date, <span class="code-string">'%Y-%m'</span>) <span class="code-keyword">as</span> report_month,
              c.customer_id,
              c.email,
              <span class="code-keyword">COUNT</span>(<span class="code-keyword">DISTINCT</span> o.order_id) <span class="code-keyword">as</span> order_count,
              <span class="code-keyword">SUM</span>(o.total_amount) <span class="code-keyword">as</span> monthly_revenue
            <span class="code-keyword">FROM</span> orders o
            <span class="code-keyword">JOIN</span> customers c <span class="code-keyword">ON</span> o.customer_id = c.customer_id
            <span class="code-keyword">WHERE</span> o.status = <span class="code-string">'delivered'</span>
            <span class="code-keyword">GROUP BY</span> report_month, c.customer_id, c.email
          )
          <span class="code-keyword">SELECT</span> 
            report_month,
            <span class="code-keyword">COUNT</span>(<span class="code-keyword">DISTINCT</span> customer_id) <span class="code-keyword">as</span> active_customers,
            <span class="code-keyword">SUM</span>(order_count) <span class="code-keyword">as</span> total_orders,
            <span class="code-keyword">ROUND</span>(<span class="code-keyword">SUM</span>(monthly_revenue), <span class="code-number">2</span>) <span class="code-keyword">as</span> monthly_revenue,
            <span class="code-keyword">ROUND</span>(<span class="code-keyword">AVG</span>(monthly_revenue), <span class="code-number">2</span>) <span class="code-keyword">as</span> avg_customer_value
          <span class="code-keyword">FROM</span> monthly_sales
          <span class="code-keyword">GROUP BY</span> report_month
          <span class="code-keyword">ORDER BY</span> report_month <span class="code-keyword">DESC</span>;
        </div>

        <div class="tag">analytics</div>
        <div class="tag">sales</div>
        <div class="tag">window-functions</div>
      </div>
    </div>

    <!-- Learning Checklist -->
    <div class="grid">
      <div class="card full-width">
        <div class="card-header">
          <span class="card-icon">‚úÖ</span>
          <span class="card-title">Learning Checklist</span>
        </div>
        
        <div class="two-col">
          <div>
            <div class="list-item">Master INNER, LEFT, RIGHT, and FULL JOINs</div>
            <div class="list-item">Write scalar and correlated subqueries</div>
            <div class="list-item">Create and use single and multiple CTEs</div>
            <div class="list-item">Implement recursive CTEs for hierarchical data</div>
          </div>
          <div>
            <div class="list-item">Apply window functions (ROW_NUMBER, RANK, SUM OVER, LAG/LEAD)</div>
            <div class="list-item">Combine JOINs with window functions for advanced analysis</div>
            <div class="list-item">Optimize queries using EXPLAIN</div>
            <div class="list-item">Build complex analytical queries for business intelligence</div>
          </div>
        </div>

        <div class="tag">joins</div>
        <div class="tag">subqueries</div>
        <div class="tag">ctes</div>
        <div class="tag">window-functions</div>
        <div class="tag">analytics</div>
      </div>
    </div>

    <div class="footer">
      <p>MySQL Cheat Sheet #3 - Intermediate Querying ‚Ä¢ Complete MySQL Knowledge Base</p>
    </div>
  </div>
</body>
</html>