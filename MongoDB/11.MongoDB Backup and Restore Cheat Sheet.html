<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MongoDB Cheat Sheet #11 - Backup and Restore</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
      color: #fff;
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
      border-radius: 15px;
    }
    .header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      color: #0f2027;
    }
    .header .subtitle {
      color: #0f2027;
      font-size: 1.1em;
      opacity: 0.9;
    }
    .badge {
      display: inline-block;
      background: rgba(15,32,39,0.3);
      color: #fff;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.85em;
      margin-top: 10px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    .card {
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(86,171,47,0.3);
    }
    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #56ab2f;
    }
    .card-icon {
      font-size: 1.8em;
      margin-right: 12px;
    }
    .card-title {
      font-size: 1.3em;
      color: #a8e063;
    }
    .code-block {
      background: #0d1117;
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.85em;
      overflow-x: auto;
      border-left: 3px solid #56ab2f;
    }
    .code-comment {
      color: #6a737d;
    }
    .code-keyword {
      color: #ff7b72;
    }
    .code-string {
      color: #a5d6ff;
    }
    .code-method {
      color: #d2a8ff;
    }
    .code-number {
      color: #79c0ff;
    }
    .code-bool {
      color: #ff7b72;
    }
    .code-prop {
      color: #7ee787;
    }
    .highlight {
      background: linear-gradient(135deg, rgba(86,171,47,0.2), rgba(168,224,99,0.2));
      padding: 15px;
      border-radius: 10px;
      margin: 10px 0;
    }
    .list-item {
      padding: 8px 0;
      padding-left: 20px;
      position: relative;
    }
    .list-item::before {
      content: "‚ñ∏";
      position: absolute;
      left: 0;
      color: #a8e063;
    }
    .tag {
      display: inline-block;
      background: rgba(86,171,47,0.2);
      color: #a8e063;
      padding: 3px 10px;
      border-radius: 5px;
      font-size: 0.8em;
      margin: 2px;
    }
    .tag-blue {
      background: rgba(33,150,243,0.2);
      color: #64b5f6;
    }
    .tag-green {
      background: rgba(76,175,80,0.2);
      color: #81c784;
    }
    .tag-orange {
      background: rgba(255,152,0,0.2);
      color: #ffb74d;
    }
    .tag-red {
      background: rgba(244,67,54,0.2);
      color: #e57373;
    }
    .tag-purple {
      background: rgba(156,39,176,0.2);
      color: #ce93d8;
    }
    .full-width {
      grid-column: 1 / -1;
    }
    .info-box {
      background: rgba(33,150,243,0.1);
      border-left: 3px solid #2196f3;
      padding: 12px;
      border-radius: 0 8px 8px 0;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .warning-box {
      background: rgba(244,67,54,0.1);
      border-left: 3px solid #f44336;
      padding: 12px;
      border-radius: 0 8px 8px 0;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .tip-box {
      background: rgba(76,175,80,0.1);
      border-left: 3px solid #4caf50;
      padding: 12px;
      border-radius: 0 8px 8px 0;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .section-title {
      color: #a8e063;
      font-size: 1.1em;
      margin: 15px 0 10px 0;
      padding-bottom: 5px;
      border-bottom: 1px dashed rgba(168,224,99,0.3);
    }
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .comparison-table th, .comparison-table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .comparison-table th {
      background: rgba(86,171,47,0.2);
      color: #a8e063;
    }
    .comparison-table tr:hover {
      background: rgba(255,255,255,0.05);
    }
    .flex-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 0;
    }
    .example-box {
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      padding: 12px;
      margin: 10px 0;
    }
    .example-title {
      color: #a8e063;
      font-weight: bold;
      margin-bottom: 8px;
      font-size: 0.9em;
    }
    .strategy-box {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin: 15px 0;
    }
    .strategy-card {
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      padding: 15px;
      border-top: 3px solid;
    }
    .strategy-card.hot {
      border-color: #e74c3c;
    }
    .strategy-card.warm {
      border-color: #f39c12;
    }
    .strategy-card.cold {
      border-color: #3498db;
    }
    .method-comparison {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin: 15px 0;
    }
    .method-card {
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      padding: 12px;
      text-align: center;
      border: 2px solid rgba(168,224,99,0.3);
    }
    .footer {
      text-align: center;
      padding: 20px;
      color: rgba(255,255,255,0.5);
      font-size: 0.9em;
    }
    @media (max-width: 768px) {
      .strategy-box, .method-comparison {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üçÉ MongoDB Cheat Sheet #11</h1>
      <div class="subtitle">Backup and Restore</div>
      <div class="badge">üíæ mongodump ‚Ä¢ mongorestore ‚Ä¢ Cloud Backup ‚Ä¢ Strategies</div>
    </div>

    <!-- Backup Overview -->
    <div class="grid">
      <div class="card full-width">
        <div class="card-header">
          <span class="card-icon">üíæ</span>
          <span class="card-title">Backup Methods Overview</span>
        </div>
        <div class="highlight">
          MongoDB cung c·∫•p nhi·ªÅu ph∆∞∆°ng ph√°p backup ph√π h·ª£p v·ªõi c√°c use cases kh√°c nhau
        </div>
        
        <table class="comparison-table">
          <tr>
            <th>Method</th>
            <th>Tool</th>
            <th>Use Case</th>
            <th>Pros</th>
            <th>Cons</th>
          </tr>
          <tr>
            <td><strong>mongodump</strong></td>
            <td>CLI utility</td>
            <td>Logical backup, small-medium DBs</td>
            <td>Simple, flexible, cross-platform</td>
            <td>Slower, kh√¥ng point-in-time</td>
          </tr>
          <tr>
            <td><strong>File System Snapshot</strong></td>
            <td>OS/Cloud tools</td>
            <td>Large databases, fast backup</td>
            <td>Very fast, point-in-time</td>
            <td>Requires storage setup</td>
          </tr>
          <tr>
            <td><strong>Cloud Backup</strong></td>
            <td>MongoDB Atlas</td>
            <td>Managed service</td>
            <td>Automated, point-in-time, easy</td>
            <td>Atlas only, cost</td>
          </tr>
          <tr>
            <td><strong>Replica Set</strong></td>
            <td>MongoDB replication</td>
            <td>High availability + backup</td>
            <td>Real-time, automatic failover</td>
            <td>Not a true backup solution</td>
          </tr>
          <tr>
            <td><strong>Ops Manager</strong></td>
            <td>Enterprise tool</td>
            <td>Enterprise deployments</td>
            <td>Full-featured, automated</td>
            <td>Complex setup, Enterprise only</td>
          </tr>
        </table>

        <div class="method-comparison">
          <div class="method-card">
            <div style="font-size: 2em; margin-bottom: 10px;">üîß</div>
            <strong style="color: #a8e063;">mongodump</strong><br>
            <small>Logical Backup</small><br>
            <small>Best for: Dev/Test</small>
          </div>
          <div class="method-card">
            <div style="font-size: 2em; margin-bottom: 10px;">üì∏</div>
            <strong style="color: #64b5f6;">Snapshots</strong><br>
            <small>Physical Backup</small><br>
            <small>Best for: Production</small>
          </div>
          <div class="method-card">
            <div style="font-size: 2em; margin-bottom: 10px;">‚òÅÔ∏è</div>
            <strong style="color: #ffb74d;">Atlas Backup</strong><br>
            <small>Managed Service</small><br>
            <small>Best for: Cloud</small>
          </div>
          <div class="method-card">
            <div style="font-size: 2em; margin-bottom: 10px;">üîÑ</div>
            <strong style="color: #ce93d8;">Replication</strong><br>
            <small>High Availability</small><br>
            <small>Best for: HA + DR</small>
          </div>
        </div>
      </div>
    </div>

    <!-- mongodump -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üì¶</span>
          <span class="card-title">mongodump - Backup</span>
        </div>
        <div class="highlight">
          Logical backup tool - export BSON format
        </div>
        
        <div class="section-title">Basic Usage</div>
        <div class="code-block">
          <span class="code-comment"># Backup to√†n b·ªô MongoDB instance</span><br>
          mongodump<br><br>
          
          <span class="code-comment"># Output m·∫∑c ƒë·ªãnh: ./dump/</span>
        </div>

        <div class="code-block">
          <span class="code-comment"># Backup v·ªõi custom output directory</span><br>
          mongodump --out=/backup/mongodb/$(date +%Y%m%d)
        </div>

        <div class="code-block">
          <span class="code-comment"># Backup specific database</span><br>
          mongodump --db=myDatabase --out=/backup/mydb<br><br>
          
          <span class="code-comment"># Backup specific collection</span><br>
          mongodump --db=myDatabase --collection=users --out=/backup/users
        </div>

        <div class="section-title">With Authentication</div>
        <div class="code-block">
          <span class="code-comment"># Backup v·ªõi username/password</span><br>
          mongodump \<br>
          &nbsp;&nbsp;--host=localhost:27017 \<br>
          &nbsp;&nbsp;--username=admin \<br>
          &nbsp;&nbsp;--password=password \<br>
          &nbsp;&nbsp;--authenticationDatabase=admin \<br>
          &nbsp;&nbsp;--out=/backup/
        </div>

        <div class="code-block">
          <span class="code-comment"># Connection string</span><br>
          mongodump \<br>
          &nbsp;&nbsp;--uri="mongodb://user:pass@host:27017/dbname?authSource=admin" \<br>
          &nbsp;&nbsp;--out=/backup/
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">‚öôÔ∏è</span>
          <span class="card-title">mongodump - Advanced Options</span>
        </div>
        
        <div class="section-title">Compression</div>
        <div class="code-block">
          <span class="code-comment"># Backup v·ªõi gzip compression</span><br>
          mongodump --gzip --out=/backup/compressed<br><br>
          
          <span class="code-comment"># Gi·∫£m k√≠ch th∆∞·ªõc backup ~70-90%</span>
        </div>

        <div class="section-title">Archive Format</div>
        <div class="code-block">
          <span class="code-comment"># Backup v√†o single archive file</span><br>
          mongodump --archive=/backup/mydb.archive<br><br>
          
          <span class="code-comment"># Archive + gzip</span><br>
          mongodump --archive=/backup/mydb.gz --gzip
        </div>

        <div class="section-title">Query Filter</div>
        <div class="code-block">
          <span class="code-comment"># Backup v·ªõi query filter</span><br>
          mongodump \<br>
          &nbsp;&nbsp;--db=myDatabase \<br>
          &nbsp;&nbsp;--collection=orders \<br>
          &nbsp;&nbsp;--query='{"status":"completed"}' \<br>
          &nbsp;&nbsp;--out=/backup/
        </div>

        <div class="section-title">Parallel Collections</div>
        <div class="code-block">
          <span class="code-comment"># Backup nhi·ªÅu collections song song</span><br>
          mongodump --numParallelCollections=4 --out=/backup/<br><br>
          
          <span class="code-comment"># TƒÉng t·ªëc ƒë·ªô backup</span>
        </div>

        <div class="tip-box">
          ‚úÖ <strong>Best Practices:</strong><br>
          ‚Ä¢ D√πng --gzip ƒë·ªÉ ti·∫øt ki·ªám storage<br>
          ‚Ä¢ D√πng --archive cho single file backup<br>
          ‚Ä¢ Set --numParallelCollections cho large DBs
        </div>
      </div>
    </div>

    <!-- mongorestore -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üì•</span>
          <span class="card-title">mongorestore - Restore</span>
        </div>
        <div class="highlight">
          Restore data t·ª´ mongodump backup
        </div>
        
        <div class="section-title">Basic Restore</div>
        <div class="code-block">
          <span class="code-comment"># Restore t·ª´ dump directory</span><br>
          mongorestore /backup/dump/<br><br>
          
          <span class="code-comment"># Restore specific database</span><br>
          mongorestore --db=myDatabase /backup/dump/myDatabase/
        </div>

        <div class="code-block">
          <span class="code-comment"># Restore specific collection</span><br>
          mongorestore \<br>
          &nbsp;&nbsp;--db=myDatabase \<br>
          &nbsp;&nbsp;--collection=users \<br>
          &nbsp;&nbsp;/backup/dump/myDatabase/users.bson
        </div>

        <div class="section-title">Drop Before Restore</div>
        <div class="code-block">
          <span class="code-comment"># Drop collection tr∆∞·ªõc khi restore</span><br>
          mongorestore --drop /backup/dump/<br><br>
          
          <span class="code-comment">// X√≥a data c≈© v√† restore data m·ªõi</span>
        </div>

        <div class="section-title">From Archive</div>
        <div class="code-block">
          <span class="code-comment"># Restore t·ª´ archive file</span><br>
          mongorestore --archive=/backup/mydb.archive<br><br>
          
          <span class="code-comment"># Restore t·ª´ gzipped archive</span><br>
          mongorestore --archive=/backup/mydb.gz --gzip
        </div>

        <div class="warning-box">
          ‚ö†Ô∏è <strong>--drop</strong> s·∫Ω x√≥a collection hi·ªán t·∫°i tr∆∞·ªõc khi restore!
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üîß</span>
          <span class="card-title">mongorestore - Advanced</span>
        </div>
        
        <div class="section-title">Rename Database</div>
        <div class="code-block">
          <span class="code-comment"># Restore v·ªõi t√™n database kh√°c</span><br>
          mongorestore \<br>
          &nbsp;&nbsp;--nsFrom='oldDB.*' \<br>
          &nbsp;&nbsp;--nsTo='newDB.*' \<br>
          &nbsp;&nbsp;/backup/dump/
        </div>

        <div class="section-title">Rename Collection</div>
        <div class="code-block">
          <span class="code-comment"># Restore v·ªõi t√™n collection kh√°c</span><br>
          mongorestore \<br>
          &nbsp;&nbsp;--nsFrom='myDB.oldCollection' \<br>
          &nbsp;&nbsp;--nsTo='myDB.newCollection' \<br>
          &nbsp;&nbsp;/backup/dump/
        </div>

        <div class="section-title">Parallel Restore</div>
        <div class="code-block">
          <span class="code-comment"># Restore nhi·ªÅu collections song song</span><br>
          mongorestore \<br>
          &nbsp;&nbsp;--numParallelCollections=4 \<br>
          &nbsp;&nbsp;--numInsertionWorkersPerCollection=2 \<br>
          &nbsp;&nbsp;/backup/dump/
        </div>

        <div class="section-title">Oplog Replay</div>
        <div class="code-block">
          <span class="code-comment"># Restore v·ªõi oplog replay (point-in-time)</span><br>
          mongorestore --oplogReplay /backup/dump/
        </div>

        <div class="info-box">
          üí° <strong>--oplogReplay</strong> cho ph√©p restore ƒë·∫øn m·ªôt th·ªùi ƒëi·ªÉm c·ª• th·ªÉ
        </div>
      </div>
    </div>

    <!-- Backup Strategies -->
    <div class="grid">
      <div class="card full-width">
        <div class="card-header">
          <span class="card-icon">üìã</span>
          <span class="card-title">Backup Strategies</span>
        </div>
        
        <div class="strategy-box">
          <div class="strategy-card hot">
            <div style="font-size: 2em; text-align: center; margin-bottom: 10px;">üî•</div>
            <strong style="color: #e74c3c; font-size: 1.1em;">Hot Backup</strong><br>
            <div style="margin-top: 10px; font-size: 0.9em;">
              <div class="list-item">Database ƒëang ch·∫°y</div>
              <div class="list-item">Kh√¥ng downtime</div>
              <div class="list-item">mongodump, snapshots</div>
              <div class="list-item">Production recommended</div>
            </div>
          </div>
          
          <div class="strategy-card warm">
            <div style="font-size: 2em; text-align: center; margin-bottom: 10px;">üå°Ô∏è</div>
            <strong style="color: #f39c12; font-size: 1.1em;">Warm Backup</strong><br>
            <div style="margin-top: 10px; font-size: 0.9em;">
              <div class="list-item">Read-only mode</div>
              <div class="list-item">Limited operations</div>
              <div class="list-item">Maintenance window</div>
              <div class="list-item">Rare use case</div>
            </div>
          </div>
          
          <div class="strategy-card cold">
            <div style="font-size: 2em; text-align: center; margin-bottom: 10px;">‚ùÑÔ∏è</div>
            <strong style="color: #3498db; font-size: 1.1em;">Cold Backup</strong><br>
            <div style="margin-top: 10px; font-size: 0.9em;">
              <div class="list-item">Database shutdown</div>
              <div class="list-item">Full downtime</div>
              <div class="list-item">Copy data files</div>
              <div class="list-item">Not recommended</div>
            </div>
          </div>
        </div>

        <div class="section-title">3-2-1 Backup Rule</div>
        <div class="example-box">
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div style="text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 8px;">
              <div style="font-size: 2.5em; color: #a8e063;">3</div>
              <strong>Copies</strong><br>
              <small>3 b·∫£n copies c·ªßa data</small>
            </div>
            <div style="text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 8px;">
              <div style="font-size: 2.5em; color: #64b5f6;">2</div>
              <strong>Media Types</strong><br>
              <small>2 lo·∫°i storage kh√°c nhau</small>
            </div>
            <div style="text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 8px;">
              <div style="font-size: 2.5em; color: #ffb74d;">1</div>
              <strong>Offsite</strong><br>
              <small>1 copy ·ªü location kh√°c</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Automated Backup Scripts -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">ü§ñ</span>
          <span class="card-title">Automated Backup Scripts</span>
        </div>
        
        <div class="section-title">Bash Script (Linux)</div>
        <div class="code-block">
          <span class="code-comment">#!/bin/bash</span><br>
          <span class="code-comment"># backup-mongodb.sh</span><br><br>
          
          <span class="code-comment"># Configuration</span><br>
          BACKUP_DIR=<span class="code-string">"/backup/mongodb"</span><br>
          DATE=$(date +%Y%m%d_%H%M%S)<br>
          MONGO_HOST=<span class="code-string">"localhost:27017"</span><br>
          MONGO_USER=<span class="code-string">"admin"</span><br>
          MONGO_PASS=<span class="code-string">"password"</span><br>
          RETENTION_DAYS=<span class="code-number">7</span><br><br>
          
          <span class="code-comment"># Create backup directory</span><br>
          mkdir -p $BACKUP_DIR<br><br>
          
          <span class="code-comment"># Perform backup</span><br>
          mongodump \<br>
          &nbsp;&nbsp;--host=$MONGO_HOST \<br>
          &nbsp;&nbsp;--username=$MONGO_USER \<br>
          &nbsp;&nbsp;--password=$MONGO_PASS \<br>
          &nbsp;&nbsp;--authenticationDatabase=admin \<br>
          &nbsp;&nbsp;--gzip \<br>
          &nbsp;&nbsp;--archive=$BACKUP_DIR/backup_$DATE.gz<br><br>
          
          <span class="code-comment"># Check if backup successful</span><br>
          <span class="code-keyword">if</span> [ $? -eq <span class="code-number">0</span> ]; <span class="code-keyword">then</span><br>
          &nbsp;&nbsp;echo <span class="code-string">"Backup successful: backup_$DATE.gz"</span><br>
          <span class="code-keyword">else</span><br>
          &nbsp;&nbsp;echo <span class="code-string">"Backup failed!"</span><br>
          &nbsp;&nbsp;exit <span class="code-number">1</span><br>
          <span class="code-keyword">fi</span><br><br>
          
          <span class="code-comment"># Delete old backups</span><br>
          find $BACKUP_DIR -name <span class="code-string">"backup_*.gz"</span> -mtime +$RETENTION_DAYS -delete<br><br>
          
          echo <span class="code-string">"Cleanup completed"</span>
        </div>

        <div class="section-title">Crontab Schedule</div>
        <div class="code-block">
          <span class="code-comment"># Edit crontab</span><br>
          crontab -e<br><br>
          
          <span class="code-comment"># Daily backup at 2 AM</span><br>
          0 2 * * * /path/to/backup-mongodb.sh<br><br>
          
          <span class="code-comment"># Every 6 hours</span><br>
          0 */6 * * * /path/to/backup-mongodb.sh<br><br>
          
          <span class="code-comment"># Weekly on Sunday at 3 AM</span><br>
          0 3 * * 0 /path/to/backup-mongodb.sh
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">ü™ü</span>
          <span class="card-title">Windows PowerShell Script</span>
        </div>
        
        <div class="code-block">
          <span class="code-comment"># backup-mongodb.ps1</span><br><br>
          
          <span class="code-comment"># Configuration</span><br>
          $BackupDir = <span class="code-string">"C:\Backup\MongoDB"</span><br>
          $Date = Get-Date -Format <span class="code-string">"yyyyMMdd_HHmmss"</span><br>
          $MongoHost = <span class="code-string">"localhost:27017"</span><br>
          $MongoUser = <span class="code-string">"admin"</span><br>
          $MongoPass = <span class="code-string">"password"</span><br>
          $RetentionDays = <span class="code-number">7</span><br><br>
          
          <span class="code-comment"># Create backup directory</span><br>
          <span class="code-keyword">if</span> (-not (Test-Path $BackupDir)) {<br>
          &nbsp;&nbsp;New-Item -ItemType Directory -Path $BackupDir<br>
          }<br><br>
          
          <span class="code-comment"># Perform backup</span><br>
          $BackupFile = <span class="code-string">"$BackupDir\backup_$Date.gz"</span><br>
          mongodump `<br>
          &nbsp;&nbsp;--host=$MongoHost `<br>
          &nbsp;&nbsp;--username=$MongoUser `<br>
          &nbsp;&nbsp;--password=$MongoPass `<br>
          &nbsp;&nbsp;--authenticationDatabase=admin `<br>
          &nbsp;&nbsp;--gzip `<br>
          &nbsp;&nbsp;--archive=$BackupFile<br><br>
          
          <span class="code-keyword">if</span> ($LASTEXITCODE -eq <span class="code-number">0</span>) {<br>
          &nbsp;&nbsp;Write-Host <span class="code-string">"Backup successful"</span><br>
          } <span class="code-keyword">else</span> {<br>
          &nbsp;&nbsp;Write-Host <span class="code-string">"Backup failed"</span><br>
          &nbsp;&nbsp;exit <span class="code-number">1</span><br>
          }<br><br>
          
          <span class="code-comment"># Delete old backups</span><br>
          Get-ChildItem $BackupDir -Filter <span class="code-string">"backup_*.gz"</span> |<br>
          &nbsp;&nbsp;Where-Object { $_.LastWriteTime -lt (Get-Date).AddDays(-$RetentionDays) } |<br>
          &nbsp;&nbsp;Remove-Item
        </div>

        <div class="section-title">Task Scheduler</div>
        <div class="code-block">
          <span class="code-comment"># Create scheduled task</span><br>
          $Action = New-ScheduledTaskAction -Execute <span class="code-string">"PowerShell.exe"</span> `<br>
          &nbsp;&nbsp;-Argument <span class="code-string">"-File C:\Scripts\backup-mongodb.ps1"</span><br><br>
          
          $Trigger = New-ScheduledTaskTrigger -Daily -At <span class="code-string">"2:00AM"</span><br><br>
          
          Register-ScheduledTask `<br>
          &nbsp;&nbsp;-TaskName <span class="code-string">"MongoDB Backup"</span> `<br>
          &nbsp;&nbsp;-Action $Action `<br>
          &nbsp;&nbsp;-Trigger $Trigger `<br>
          &nbsp;&nbsp;-User <span class="code-string">"SYSTEM"</span>
        </div>
      </div>
    </div>

    <!-- File System Snapshots -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üì∏</span>
          <span class="card-title">File System Snapshots</span>
        </div>
        <div class="highlight">
          Physical backup - nhanh v√† hi·ªáu qu·∫£ cho large databases
        </div>
        
        <div class="section-title">Prerequisites</div>
        <div class="list-item">MongoDB ƒëang ch·∫°y tr√™n storage h·ªó tr·ª£ snapshots (LVM, EBS, Azure Disk...)</div>
        <div class="list-item">Journaling enabled (m·∫∑c ƒë·ªãnh)</div>
        <div class="list-item">Data v√† journal tr√™n c√πng volume</div>

        <div class="section-title">Snapshot Process</div>
        <div class="code-block">
          <span class="code-comment">// 1. Flush v√† lock writes (optional)</span><br>
          db.<span class="code-method">fsyncLock</span>()<br><br>
          
          <span class="code-comment">// 2. Create snapshot (OS/Cloud specific)</span><br>
          <span class="code-comment"># LVM example:</span><br>
          lvcreate --size 10G --snapshot --name mongo-snap /dev/vg/mongo<br><br>
          
          <span class="code-comment">// 3. Unlock writes</span><br>
          db.<span class="code-method">fsyncUnlock</span>()
        </div>

        <div class="section-title">AWS EBS Snapshot</div>
        <div class="code-block">
          <span class="code-comment"># Create EBS snapshot</span><br>
          aws ec2 create-snapshot \<br>
          &nbsp;&nbsp;--volume-id vol-1234567890abcdef0 \<br>
          &nbsp;&nbsp;--description <span class="code-string">"MongoDB backup $(date +%Y%m%d)"</span>
        </div>

        <div class="tip-box">
          ‚úÖ <strong>Advantages:</strong><br>
          ‚Ä¢ Very fast (seconds)<br>
          ‚Ä¢ Minimal impact on performance<br>
          ‚Ä¢ Point-in-time recovery<br>
          ‚Ä¢ Suitable for large databases
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">‚òÅÔ∏è</span>
          <span class="card-title">MongoDB Atlas Backup</span>
        </div>
        <div class="highlight">
          Fully managed backup service
        </div>
        
        <div class="section-title">Features</div>
        <div class="list-item">Continuous backup (oplog-based)</div>
        <div class="list-item">Point-in-time recovery</div>
        <div class="list-item">Automated scheduling</div>
        <div class="list-item">Encrypted backups</div>
        <div class="list-item">Cross-region backup</div>
        <div class="list-item">Queryable backups</div>

        <div class="section-title">Enable Atlas Backup</div>
        <div class="code-block">
          <span class="code-comment">// Via Atlas UI:</span><br>
          1. Navigate to Cluster<br>
          2. Click "Backup" tab<br>
          3. Enable "Continuous Backup"<br>
          4. Configure retention policy<br>
          5. Set backup schedule
        </div>

        <div class="section-title">Restore from Atlas</div>
        <div class="code-block">
          <span class="code-comment">// Point-in-time restore:</span><br>
          1. Go to Backup tab<br>
          2. Select snapshot or timestamp<br>
          3. Choose restore method:<br>
          &nbsp;&nbsp;- Automated restore to new cluster<br>
          &nbsp;&nbsp;- Download backup files<br>
          &nbsp;&nbsp;- Query backup (read-only)
        </div>

        <div class="info-box">
          üí° Atlas Backup t·ª± ƒë·ªông handle:<br>
          ‚Ä¢ Replica set consistency<br>
          ‚Ä¢ Sharded cluster coordination<br>
          ‚Ä¢ Encryption at rest<br>
          ‚Ä¢ Compliance requirements
        </div>
      </div>
    </div>

    <!-- Disaster Recovery -->
    <div class="grid">
      <div class="card full-width">
        <div class="card-header">
          <span class="card-icon">üÜò</span>
          <span class="card-title">Disaster Recovery Plan</span>
        </div>
        
        <div class="section-title">RTO & RPO</div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0;">
          <div class="example-box">
            <div class="example-title">RTO (Recovery Time Objective)</div>
            <div style="font-size: 2em; text-align: center; color: #e74c3c; margin: 10px 0;">‚è±Ô∏è</div>
            <div>Th·ªùi gian t·ªëi ƒëa ƒë·ªÉ restore service</div>
            <div style="margin-top: 10px;">
              <strong>Example:</strong><br>
              ‚Ä¢ Critical: < 1 hour<br>
              ‚Ä¢ Important: < 4 hours<br>
              ‚Ä¢ Normal: < 24 hours
            </div>
          </div>
          <div class="example-box">
            <div class="example-title">RPO (Recovery Point Objective)</div>
            <div style="font-size: 2em; text-align: center; color: #f39c12; margin: 10px 0;">üíæ</div>
            <div>L∆∞·ª£ng data t·ªëi ƒëa c√≥ th·ªÉ m·∫•t</div>
            <div style="margin-top: 10px;">
              <strong>Example:</strong><br>
              ‚Ä¢ Critical: < 5 minutes<br>
              ‚Ä¢ Important: < 1 hour<br>
              ‚Ä¢ Normal: < 24 hours
            </div>
          </div>
        </div>

        <div class="section-title">DR Strategy Matrix</div>
        <table class="comparison-table">
          <tr>
            <th>Strategy</th>
            <th>RTO</th>
            <th>RPO</th>
            <th>Cost</th>
            <th>Complexity</th>
          </tr>
          <tr>
            <td><strong>Backup & Restore</strong></td>
            <td>Hours-Days</td>
            <td>Hours-Days</td>
            <td>üí∞ Low</td>
            <td>‚≠ê Simple</td>
          </tr>
          <tr>
            <td><strong>Pilot Light</strong></td>
            <td>Hours</td>
            <td>Minutes-Hours</td>
            <td>üí∞üí∞ Medium</td>
            <td>‚≠ê‚≠ê Medium</td>
          </tr>
          <tr>
            <td><strong>Warm Standby</strong></td>
            <td>Minutes</td>
            <td>Minutes</td>
            <td>üí∞üí∞üí∞ High</td>
            <td>‚≠ê‚≠ê‚≠ê Complex</td>
          </tr>
          <tr>
            <td><strong>Multi-Region Active</strong></td>
            <td>Seconds</td>
            <td>Seconds</td>
            <td>üí∞üí∞üí∞üí∞ Very High</td>
            <td>‚≠ê‚≠ê‚≠ê‚≠ê Very Complex</td>
          </tr>
        </table>

        <div class="section-title">DR Checklist</div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
          <div class="example-box">
            <div class="example-title">‚úÖ Before Disaster</div>
            <div class="list-item">Document backup procedures</div>
            <div class="list-item">Test restore regularly</div>
            <div class="list-item">Monitor backup success</div>
            <div class="list-item">Maintain offsite backups</div>
            <div class="list-item">Train team on procedures</div>
          </div>
          <div class="example-box">
            <div class="example-title">üö® During Disaster</div>
            <div class="list-item">Assess damage scope</div>
            <div class="list-item">Activate DR plan</div>
            <div class="list-item">Communicate with stakeholders</div>
            <div class="list-item">Begin recovery process</div>
            <div class="list-item">Document all actions</div>
          </div>
          <div class="example-box">
            <div class="example-title">üìù After Recovery</div>
            <div class="list-item">Verify data integrity</div>
            <div class="list-item">Test application functionality</div>
            <div class="list-item">Post-mortem analysis</div>
            <div class="list-item">Update DR procedures</div>
            <div class="list-item">Resume normal backups</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Best Practices -->
    <div class="grid">
      <div class="card full-width">
        <div class="card-header">
          <span class="card-icon">‚≠ê</span>
          <span class="card-title">Backup Best Practices</span>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
          <div>
            <div class="section-title">‚úÖ DO's</div>
            <div class="list-item">Automate backup process</div>
            <div class="list-item">Test restore regularly (monthly)</div>
            <div class="list-item">Monitor backup success/failure</div>
            <div class="list-item">Encrypt backups at rest and in transit</div>
            <div class="list-item">Store backups in multiple locations</div>
            <div class="list-item">Document backup procedures</div>
            <div class="list-item">Set appropriate retention policies</div>
            <div class="list-item">Use compression to save storage</div>
            <div class="list-item">Label backups with timestamps</div>
            <div class="list-item">Verify backup integrity</div>
          </div>
          
          <div>
            <div class="section-title">‚ùå DON'Ts</div>
            <div class="list-item">Kh√¥ng rely ch·ªâ tr√™n replication</div>
            <div class="list-item">Kh√¥ng store backups c√πng server</div>
            <div class="list-item">Kh√¥ng skip testing restore</div>
            <div class="list-item">Kh√¥ng ignore backup failures</div>
            <div class="list-item">Kh√¥ng backup khi kh√¥ng c·∫ßn</div>
            <div class="list-item">Kh√¥ng qu√™n rotate old backups</div>
            <div class="list-item">Kh√¥ng hardcode credentials</div>
            <div class="list-item">Kh√¥ng backup without monitoring</div>
          </div>
        </div>

        <div class="section-title">Backup Verification</div>
        <div class="code-block">
          <span class="code-comment"># Verify backup file exists v√† c√≥ size</span><br>
          ls -lh /backup/mongodb/backup_*.gz<br><br>
          
          <span class="code-comment"># Test restore to temporary database</span><br>
          mongorestore \<br>
          &nbsp;&nbsp;--db=test_restore \<br>
          &nbsp;&nbsp;--archive=/backup/mongodb/backup_latest.gz \<br>
          &nbsp;&nbsp;--gzip<br><br>
          
          <span class="code-comment"># Verify document count</span><br>
          mongosh --eval <span class="code-string">"db.getSiblingDB('test_restore').stats()"</span><br><br>
          
          <span class="code-comment"># Cleanup test database</span><br>
          mongosh --eval <span class="code-string">"db.getSiblingDB('test_restore').dropDatabase()"</span>
        </div>
      </div>
    </div>

    <!-- Quick Reference -->
    <div class="grid">
      <div class="card full-width">
        <div class="card-header">
          <span class="card-icon">üìö</span>
          <span class="card-title">Quick Reference - Backup Commands</span>
        </div>
        <table class="comparison-table">
          <tr>
            <th>Task</th>
            <th>Command</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td colspan="3"><strong>mongodump</strong></td>
          </tr>
          <tr>
            <td>Full backup</td>
            <td><code>mongodump --out=/backup/</code></td>
            <td>Backup all databases</td>
          </tr>
          <tr>
            <td>Single DB</td>
            <td><code>mongodump --db=mydb --out=/backup/</code></td>
            <td>Backup one database</td>
          </tr>
          <tr>
            <td>Compressed</td>
            <td><code>mongodump --gzip --out=/backup/</code></td>
            <td>Save storage space</td>
          </tr>
          <tr>
            <td>Archive</td>
            <td><code>mongodump --archive=/backup/db.gz --gzip</code></td>
            <td>Single file backup</td>
          </tr>
          <tr>
            <td colspan="3"><strong>mongorestore</strong></td>
          </tr>
          <tr>
            <td>Full restore</td>
            <td><code>mongorestore /backup/dump/</code></td>
            <td>Restore all databases</td>
          </tr>
          <tr>
            <td>Single DB</td>
            <td><code>mongorestore --db=mydb /backup/dump/mydb/</code></td>
            <td>Restore one database</td>
          </tr>
          <tr>
            <td>Drop & Restore</td>
            <td><code>mongorestore --drop /backup/dump/</code></td>
            <td>Replace existing data</td>
          </tr>
          <tr>
            <td>From Archive</td>
            <td><code>mongorestore --archive=/backup/db.gz --gzip</code></td>
            <td>Restore from archive</td>
          </tr>
        </table>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <p>üìö MongoDB Cheat Sheet Series | Part 11 of 16</p>
      <p>Created with Monica AI | December 2024</p>
    </div>
  </div>
</body>
</html>