<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MongoDB Cheat Sheet #8 - Indexing</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #141e30 0%, #243b55 100%);
      color: #fff;
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      border-radius: 15px;
    }
    .header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      color: #fff;
    }
    .header .subtitle {
      color: #fff;
      font-size: 1.1em;
      opacity: 0.9;
    }
    .badge {
      display: inline-block;
      background: rgba(0,0,0,0.3);
      color: #fff;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.85em;
      margin-top: 10px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    .card {
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(240,147,251,0.3);
    }
    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f093fb;
    }
    .card-icon {
      font-size: 1.8em;
      margin-right: 12px;
    }
    .card-title {
      font-size: 1.3em;
      color: #f093fb;
    }
    .code-block {
      background: #0d1117;
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.85em;
      overflow-x: auto;
      border-left: 3px solid #f093fb;
    }
    .code-comment {
      color: #6a737d;
    }
    .code-keyword {
      color: #ff7b72;
    }
    .code-string {
      color: #a5d6ff;
    }
    .code-method {
      color: #d2a8ff;
    }
    .code-number {
      color: #79c0ff;
    }
    .code-bool {
      color: #ff7b72;
    }
    .code-prop {
      color: #7ee787;
    }
    .highlight {
      background: linear-gradient(135deg, rgba(240,147,251,0.2), rgba(245,87,108,0.2));
      padding: 15px;
      border-radius: 10px;
      margin: 10px 0;
    }
    .list-item {
      padding: 8px 0;
      padding-left: 20px;
      position: relative;
    }
    .list-item::before {
      content: "‚ñ∏";
      position: absolute;
      left: 0;
      color: #f093fb;
    }
    .tag {
      display: inline-block;
      background: rgba(240,147,251,0.2);
      color: #f093fb;
      padding: 3px 10px;
      border-radius: 5px;
      font-size: 0.8em;
      margin: 2px;
    }
    .tag-blue {
      background: rgba(33,150,243,0.2);
      color: #64b5f6;
    }
    .tag-green {
      background: rgba(76,175,80,0.2);
      color: #81c784;
    }
    .tag-orange {
      background: rgba(255,152,0,0.2);
      color: #ffb74d;
    }
    .tag-red {
      background: rgba(244,67,54,0.2);
      color: #e57373;
    }
    .tag-purple {
      background: rgba(156,39,176,0.2);
      color: #ce93d8;
    }
    .tag-cyan {
      background: rgba(0,188,212,0.2);
      color: #4dd0e1;
    }
    .full-width {
      grid-column: 1 / -1;
    }
    .info-box {
      background: rgba(33,150,243,0.1);
      border-left: 3px solid #2196f3;
      padding: 12px;
      border-radius: 0 8px 8px 0;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .warning-box {
      background: rgba(244,67,54,0.1);
      border-left: 3px solid #f44336;
      padding: 12px;
      border-radius: 0 8px 8px 0;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .tip-box {
      background: rgba(76,175,80,0.1);
      border-left: 3px solid #4caf50;
      padding: 12px;
      border-radius: 0 8px 8px 0;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .section-title {
      color: #f093fb;
      font-size: 1.1em;
      margin: 15px 0 10px 0;
      padding-bottom: 5px;
      border-bottom: 1px dashed rgba(240,147,251,0.3);
    }
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .comparison-table th, .comparison-table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .comparison-table th {
      background: rgba(240,147,251,0.2);
      color: #f093fb;
    }
    .comparison-table tr:hover {
      background: rgba(255,255,255,0.05);
    }
    .flex-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 0;
    }
    .example-box {
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      padding: 12px;
      margin: 10px 0;
    }
    .example-title {
      color: #f093fb;
      font-weight: bold;
      margin-bottom: 8px;
      font-size: 0.9em;
    }
    .performance-box {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 10px 0;
    }
    .perf-good {
      background: rgba(76,175,80,0.1);
      border-left: 3px solid #4caf50;
      padding: 10px;
      border-radius: 0 8px 8px 0;
    }
    .perf-bad {
      background: rgba(244,67,54,0.1);
      border-left: 3px solid #f44336;
      padding: 10px;
      border-radius: 0 8px 8px 0;
    }
    .footer {
      text-align: center;
      padding: 20px;
      color: rgba(255,255,255,0.5);
      font-size: 0.9em;
    }
    @media (max-width: 768px) {
      .performance-box {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üçÉ MongoDB Cheat Sheet #8</h1>
      <div class="subtitle">Indexing in MongoDB</div>
      <div class="badge">üöÄ Performance Optimization ‚Ä¢ Index Types ‚Ä¢ Best Practices</div>
    </div>

    <!-- Index Overview -->
    <div class="grid">
      <div class="card full-width">
        <div class="card-header">
          <span class="card-icon">üìä</span>
          <span class="card-title">Index Overview</span>
        </div>
        <div class="highlight">
          Index l√† c·∫•u tr√∫c d·ªØ li·ªáu ƒë·∫∑c bi·ªát gi√∫p tƒÉng t·ªëc ƒë·ªô query - gi·ªëng nh∆∞ m·ª•c l·ª•c trong s√°ch
        </div>
        
        <table class="comparison-table">
          <tr>
            <th>Index Type</th>
            <th>Syntax</th>
            <th>Use Case</th>
          </tr>
          <tr>
            <td><strong>Single Field</strong></td>
            <td><code>{field: 1}</code></td>
            <td>Query tr√™n 1 field</td>
          </tr>
          <tr>
            <td><strong>Compound</strong></td>
            <td><code>{field1: 1, field2: -1}</code></td>
            <td>Query tr√™n nhi·ªÅu fields</td>
          </tr>
          <tr>
            <td><strong>Multikey</strong></td>
            <td><code>{arrayField: 1}</code></td>
            <td>Index tr√™n array elements</td>
          </tr>
          <tr>
            <td><strong>Text</strong></td>
            <td><code>{field: "text"}</code></td>
            <td>Full-text search</td>
          </tr>
          <tr>
            <td><strong>Geospatial</strong></td>
            <td><code>{location: "2dsphere"}</code></td>
            <td>Location-based queries</td>
          </tr>
          <tr>
            <td><strong>Hashed</strong></td>
            <td><code>{field: "hashed"}</code></td>
            <td>Sharding, equality queries</td>
          </tr>
          <tr>
            <td><strong>Wildcard</strong></td>
            <td><code>{"$**": 1}</code></td>
            <td>Dynamic/unknown fields</td>
          </tr>
        </table>

        <div class="performance-box">
          <div class="perf-good">
            <strong style="color: #81c784;">‚úÖ V·ªõi Index:</strong><br>
            ‚Ä¢ Query nhanh (ms)<br>
            ‚Ä¢ Scan √≠t documents<br>
            ‚Ä¢ Efficient sorting
          </div>
          <div class="perf-bad">
            <strong style="color: #e57373;">‚ùå Kh√¥ng Index:</strong><br>
            ‚Ä¢ Collection scan (ch·∫≠m)<br>
            ‚Ä¢ Scan to√†n b·ªô documents<br>
            ‚Ä¢ Memory-intensive sort
          </div>
        </div>
      </div>
    </div>

    <!-- Single Field Index -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">1Ô∏è‚É£</span>
          <span class="card-title">Single Field Index</span>
        </div>
        <div class="highlight">
          Index tr√™n m·ªôt field duy nh·∫•t
        </div>
        
        <div class="code-block">
          <span class="code-comment">// T·∫°o ascending index (1)</span><br>
          db.users.<span class="code-method">createIndex</span>({ <span class="code-prop">email</span>: <span class="code-number">1</span> })
        </div>

        <div class="code-block">
          <span class="code-comment">// T·∫°o descending index (-1)</span><br>
          db.products.<span class="code-method">createIndex</span>({ <span class="code-prop">price</span>: <span class="code-number">-1</span> })
        </div>

        <div class="code-block">
          <span class="code-comment">// Index v·ªõi options</span><br>
          db.users.<span class="code-method">createIndex</span>(<br>
          &nbsp;&nbsp;{ <span class="code-prop">email</span>: <span class="code-number">1</span> },<br>
          &nbsp;&nbsp;{<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">unique</span>: <span class="code-bool">true</span>,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">name</span>: <span class="code-string">"email_unique_idx"</span><br>
          &nbsp;&nbsp;}<br>
          )
        </div>

        <div class="code-block">
          <span class="code-comment">// Index tr√™n nested field</span><br>
          db.users.<span class="code-method">createIndex</span>({ <span class="code-string">"address.city"</span>: <span class="code-number">1</span> })
        </div>

        <div class="tip-box">
          ‚úÖ Single field index h·ªó tr·ª£:<br>
          ‚Ä¢ Equality queries: <code>{field: value}</code><br>
          ‚Ä¢ Range queries: <code>{field: {$gt: value}}</code><br>
          ‚Ä¢ Sort operations: <code>.sort({field: 1})</code>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üîë</span>
          <span class="card-title">_id Index (Default)</span>
        </div>
        <div class="highlight">
          MongoDB t·ª± ƒë·ªông t·∫°o unique index tr√™n _id
        </div>
        
        <div class="code-block">
          <span class="code-comment">// _id index t·ª± ƒë·ªông t·ªìn t·∫°i</span><br>
          db.users.<span class="code-method">getIndexes</span>()<br><br>
          
          <span class="code-comment">// Output:</span><br>
          [<br>
          &nbsp;&nbsp;{<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">v</span>: <span class="code-number">2</span>,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">key</span>: { <span class="code-prop">_id</span>: <span class="code-number">1</span> },<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">name</span>: <span class="code-string">"_id_"</span><br>
          &nbsp;&nbsp;}<br>
          ]
        </div>

        <div class="warning-box">
          ‚ö†Ô∏è <strong>KH√îNG TH·ªÇ</strong> x√≥a _id index
        </div>

        <div class="code-block">
          <span class="code-comment">// Query s·ª≠ d·ª•ng _id index (r·∫•t nhanh)</span><br>
          db.users.<span class="code-method">find</span>({ <span class="code-prop">_id</span>: <span class="code-method">ObjectId</span>(<span class="code-string">"..."</span>) })<br><br>
          
          <span class="code-comment">// findById trong drivers</span><br>
          db.users.<span class="code-method">findOne</span>({ <span class="code-prop">_id</span>: id })
        </div>

        <div class="info-box">
          üí° _id index l√† <strong>unique</strong> v√† <strong>clustered</strong> (documents ƒë∆∞·ª£c l∆∞u theo th·ª© t·ª± _id)
        </div>
      </div>
    </div>

    <!-- Compound Index -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üîó</span>
          <span class="card-title">Compound Index</span>
        </div>
        <div class="highlight">
          Index tr√™n nhi·ªÅu fields - th·ª© t·ª± fields quan tr·ªçng!
        </div>
        
        <div class="code-block">
          <span class="code-comment">// Compound index: status + createdAt</span><br>
          db.orders.<span class="code-method">createIndex</span>({<br>
          &nbsp;&nbsp;<span class="code-prop">status</span>: <span class="code-number">1</span>,<br>
          &nbsp;&nbsp;<span class="code-prop">createdAt</span>: <span class="code-number">-1</span><br>
          })
        </div>

        <div class="example-box">
          <div class="example-title">Index n√†y h·ªó tr·ª£ queries:</div>
          <div class="code-block">
            <span class="code-comment">// ‚úÖ D√πng ƒë∆∞·ª£c index</span><br>
            { status: <span class="code-string">"completed"</span> }<br>
            { status: <span class="code-string">"completed"</span>, createdAt: { <span class="code-keyword">$gte</span>: date } }<br><br>
            
            <span class="code-comment">// ‚ùå KH√îNG d√πng ƒë∆∞·ª£c index</span><br>
            { createdAt: { <span class="code-keyword">$gte</span>: date } }<br>
            <span class="code-comment">// V√¨ createdAt kh√¥ng ph·∫£i prefix</span>
          </div>
        </div>

        <div class="code-block">
          <span class="code-comment">// Compound index 3 fields</span><br>
          db.products.<span class="code-method">createIndex</span>({<br>
          &nbsp;&nbsp;<span class="code-prop">category</span>: <span class="code-number">1</span>,<br>
          &nbsp;&nbsp;<span class="code-prop">brand</span>: <span class="code-number">1</span>,<br>
          &nbsp;&nbsp;<span class="code-prop">price</span>: <span class="code-number">-1</span><br>
          })
        </div>

        <div class="tip-box">
          ‚úÖ <strong>ESR Rule:</strong><br>
          <strong>E</strong>quality ‚Üí <strong>S</strong>ort ‚Üí <strong>R</strong>ange<br>
          S·∫Øp x·∫øp fields theo th·ª© t·ª± n√†y ƒë·ªÉ t·ªëi ∆∞u
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üìè</span>
          <span class="card-title">Index Prefix</span>
        </div>
        <div class="highlight">
          Compound index c√≥ th·ªÉ d√πng nh∆∞ nhi·ªÅu indexes
        </div>
        
        <div class="code-block">
          <span class="code-comment">// T·∫°o compound index</span><br>
          db.users.<span class="code-method">createIndex</span>({<br>
          &nbsp;&nbsp;<span class="code-prop">country</span>: <span class="code-number">1</span>,<br>
          &nbsp;&nbsp;<span class="code-prop">city</span>: <span class="code-number">1</span>,<br>
          &nbsp;&nbsp;<span class="code-prop">age</span>: <span class="code-number">1</span><br>
          })
        </div>

        <div class="example-box">
          <div class="example-title">Index n√†y h·ªó tr·ª£ c√°c prefixes:</div>
          <div class="code-block">
            <span class="code-comment">// ‚úÖ Prefix 1: {country: 1}</span><br>
            db.users.<span class="code-method">find</span>({ country: <span class="code-string">"Vietnam"</span> })<br><br>
            
            <span class="code-comment">// ‚úÖ Prefix 2: {country: 1, city: 1}</span><br>
            db.users.<span class="code-method">find</span>({ country: <span class="code-string">"Vietnam"</span>, city: <span class="code-string">"Hanoi"</span> })<br><br>
            
            <span class="code-comment">// ‚úÖ Full index: {country: 1, city: 1, age: 1}</span><br>
            db.users.<span class="code-method">find</span>({ country: <span class="code-string">"Vietnam"</span>, city: <span class="code-string">"Hanoi"</span>, age: <span class="code-number">25</span> })
          </div>
        </div>

        <div class="warning-box">
          ‚ö†Ô∏è <strong>KH√îNG h·ªó tr·ª£:</strong><br>
          ‚Ä¢ <code>{city: 1}</code> - thi·∫øu country<br>
          ‚Ä¢ <code>{age: 1}</code> - thi·∫øu country & city<br>
          ‚Ä¢ <code>{city: 1, age: 1}</code> - thi·∫øu country
        </div>
      </div>
    </div>

    <!-- Index Properties -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">‚öôÔ∏è</span>
          <span class="card-title">Index Properties</span>
        </div>
        
        <div class="section-title">Unique Index</div>
        <div class="code-block">
          <span class="code-comment">// ƒê·∫£m b·∫£o gi√° tr·ªã unique</span><br>
          db.users.<span class="code-method">createIndex</span>(<br>
          &nbsp;&nbsp;{ <span class="code-prop">email</span>: <span class="code-number">1</span> },<br>
          &nbsp;&nbsp;{ <span class="code-prop">unique</span>: <span class="code-bool">true</span> }<br>
          )<br><br>
          
          <span class="code-comment">// Compound unique index</span><br>
          db.users.<span class="code-method">createIndex</span>(<br>
          &nbsp;&nbsp;{ <span class="code-prop">username</span>: <span class="code-number">1</span>, <span class="code-prop">provider</span>: <span class="code-number">1</span> },<br>
          &nbsp;&nbsp;{ <span class="code-prop">unique</span>: <span class="code-bool">true</span> }<br>
          )
        </div>

        <div class="section-title">Sparse Index</div>
        <div class="code-block">
          <span class="code-comment">// Ch·ªâ index documents c√≥ field</span><br>
          db.users.<span class="code-method">createIndex</span>(<br>
          &nbsp;&nbsp;{ <span class="code-prop">phone</span>: <span class="code-number">1</span> },<br>
          &nbsp;&nbsp;{ <span class="code-prop">sparse</span>: <span class="code-bool">true</span> }<br>
          )<br><br>
          
          <span class="code-comment">// Documents kh√¥ng c√≥ "phone" s·∫Ω kh√¥ng ƒë∆∞·ª£c index</span>
        </div>

        <div class="section-title">Partial Index</div>
        <div class="code-block">
          <span class="code-comment">// Index ch·ªâ documents th·ªèa ƒëi·ªÅu ki·ªán</span><br>
          db.orders.<span class="code-method">createIndex</span>(<br>
          &nbsp;&nbsp;{ <span class="code-prop">customerId</span>: <span class="code-number">1</span> },<br>
          &nbsp;&nbsp;{<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">partialFilterExpression</span>: {<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">status</span>: { <span class="code-keyword">$in</span>: [<span class="code-string">"pending"</span>, <span class="code-string">"processing"</span>] }<br>
          &nbsp;&nbsp;&nbsp;&nbsp;}<br>
          &nbsp;&nbsp;}<br>
          )<br><br>
          
          <span class="code-comment">// Ch·ªâ index orders c√≥ status pending/processing</span>
        </div>

        <div class="tip-box">
          ‚úÖ <strong>Partial index</strong> gi√∫p gi·∫£m k√≠ch th∆∞·ªõc index v√† tƒÉng performance
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">‚è∞</span>
          <span class="card-title">TTL Index & Background</span>
        </div>
        
        <div class="section-title">TTL Index (Time-To-Live)</div>
        <div class="code-block">
          <span class="code-comment">// T·ª± ƒë·ªông x√≥a documents sau 3600 gi√¢y</span><br>
          db.sessions.<span class="code-method">createIndex</span>(<br>
          &nbsp;&nbsp;{ <span class="code-prop">createdAt</span>: <span class="code-number">1</span> },<br>
          &nbsp;&nbsp;{ <span class="code-prop">expireAfterSeconds</span>: <span class="code-number">3600</span> }<br>
          )
        </div>

        <div class="code-block">
          <span class="code-comment">// TTL v·ªõi expireAt field c·ª• th·ªÉ</span><br>
          db.events.<span class="code-method">createIndex</span>(<br>
          &nbsp;&nbsp;{ <span class="code-prop">expireAt</span>: <span class="code-number">1</span> },<br>
          &nbsp;&nbsp;{ <span class="code-prop">expireAfterSeconds</span>: <span class="code-number">0</span> }<br>
          )<br><br>
          
          <span class="code-comment">// Document t·ª± ƒë·ªông x√≥a t·∫°i th·ªùi ƒëi·ªÉm expireAt</span><br>
          {<br>
          &nbsp;&nbsp;event: <span class="code-string">"sale"</span>,<br>
          &nbsp;&nbsp;expireAt: <span class="code-method">ISODate</span>(<span class="code-string">"2024-12-31T23:59:59Z"</span>)<br>
          }
        </div>

        <div class="section-title">Background Index</div>
        <div class="code-block">
          <span class="code-comment">// T·∫°o index kh√¥ng block operations (deprecated)</span><br>
          db.users.<span class="code-method">createIndex</span>(<br>
          &nbsp;&nbsp;{ <span class="code-prop">name</span>: <span class="code-number">1</span> },<br>
          &nbsp;&nbsp;{ <span class="code-prop">background</span>: <span class="code-bool">true</span> }<br>
          )
        </div>

        <div class="info-box">
          üí° MongoDB 4.2+: T·∫•t c·∫£ indexes ƒë·ªÅu build optimized, kh√¥ng c·∫ßn <code>background: true</code>
        </div>
      </div>
    </div>

    <!-- Multikey & Text Index -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üìö</span>
          <span class="card-title">Multikey Index (Arrays)</span>
        </div>
        <div class="highlight">
          T·ª± ƒë·ªông t·∫°o khi index field l√† array
        </div>
        
        <div class="code-block">
          <span class="code-comment">// Index tr√™n array field</span><br>
          db.posts.<span class="code-method">createIndex</span>({ <span class="code-prop">tags</span>: <span class="code-number">1</span> })
        </div>

        <div class="example-box">
          <div class="example-title">Document:</div>
          <div class="code-block">
            {<br>
            &nbsp;&nbsp;<span class="code-prop">_id</span>: <span class="code-number">1</span>,<br>
            &nbsp;&nbsp;<span class="code-prop">title</span>: <span class="code-string">"MongoDB Tutorial"</span>,<br>
            &nbsp;&nbsp;<span class="code-prop">tags</span>: [<span class="code-string">"mongodb"</span>, <span class="code-string">"database"</span>, <span class="code-string">"nosql"</span>]<br>
            }
          </div>
          <div class="example-title">Index entries (multikey):</div>
          <div class="code-block">
            <span class="code-string">"mongodb"</span> ‚Üí doc 1<br>
            <span class="code-string">"database"</span> ‚Üí doc 1<br>
            <span class="code-string">"nosql"</span> ‚Üí doc 1
          </div>
        </div>

        <div class="code-block">
          <span class="code-comment">// Query s·ª≠ d·ª•ng multikey index</span><br>
          db.posts.<span class="code-method">find</span>({ <span class="code-prop">tags</span>: <span class="code-string">"mongodb"</span> })<br>
          db.posts.<span class="code-method">find</span>({ <span class="code-prop">tags</span>: { <span class="code-keyword">$in</span>: [<span class="code-string">"mongodb"</span>, <span class="code-string">"nosql"</span>] } })
        </div>

        <div class="code-block">
          <span class="code-comment">// Compound multikey index</span><br>
          db.products.<span class="code-method">createIndex</span>({<br>
          &nbsp;&nbsp;<span class="code-prop">category</span>: <span class="code-number">1</span>,<br>
          &nbsp;&nbsp;<span class="code-prop">tags</span>: <span class="code-number">1</span><br>
          })
        </div>

        <div class="warning-box">
          ‚ö†Ô∏è Compound index ch·ªâ c√≥ th·ªÉ c√≥ <strong>1 array field</strong>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üî§</span>
          <span class="card-title">Text Index (Full-Text Search)</span>
        </div>
        <div class="highlight">
          Index cho full-text search
        </div>
        
        <div class="code-block">
          <span class="code-comment">// T·∫°o text index</span><br>
          db.posts.<span class="code-method">createIndex</span>({<br>
          &nbsp;&nbsp;<span class="code-prop">title</span>: <span class="code-string">"text"</span>,<br>
          &nbsp;&nbsp;<span class="code-prop">content</span>: <span class="code-string">"text"</span><br>
          })
        </div>

        <div class="code-block">
          <span class="code-comment">// Text search</span><br>
          db.posts.<span class="code-method">find</span>({<br>
          &nbsp;&nbsp;<span class="code-keyword">$text</span>: { <span class="code-keyword">$search</span>: <span class="code-string">"mongodb database"</span> }<br>
          })
        </div>

        <div class="code-block">
          <span class="code-comment">// Text index v·ªõi weights</span><br>
          db.posts.<span class="code-method">createIndex</span>(<br>
          &nbsp;&nbsp;{<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">title</span>: <span class="code-string">"text"</span>,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">content</span>: <span class="code-string">"text"</span><br>
          &nbsp;&nbsp;},<br>
          &nbsp;&nbsp;{<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">weights</span>: {<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">title</span>: <span class="code-number">10</span>,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">content</span>: <span class="code-number">5</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;}<br>
          &nbsp;&nbsp;}<br>
          )
        </div>

        <div class="code-block">
          <span class="code-comment">// Wildcard text index</span><br>
          db.posts.<span class="code-method">createIndex</span>({ <span class="code-string">"$**"</span>: <span class="code-string">"text"</span> })
        </div>

        <div class="warning-box">
          ‚ö†Ô∏è M·ªói collection ch·ªâ c√≥ th·ªÉ c√≥ <strong>1 text index</strong>
        </div>
      </div>
    </div>

    <!-- Geospatial & Hashed Index -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üåç</span>
          <span class="card-title">Geospatial Index</span>
        </div>
        <div class="highlight">
          Index cho location-based queries
        </div>
        
        <div class="section-title">2dsphere Index (Earth-like sphere)</div>
        <div class="code-block">
          <span class="code-comment">// T·∫°o 2dsphere index</span><br>
          db.places.<span class="code-method">createIndex</span>({ <span class="code-prop">location</span>: <span class="code-string">"2dsphere"</span> })
        </div>

        <div class="code-block">
          <span class="code-comment">// GeoJSON Point format</span><br>
          {<br>
          &nbsp;&nbsp;<span class="code-prop">name</span>: <span class="code-string">"Hanoi"</span>,<br>
          &nbsp;&nbsp;<span class="code-prop">location</span>: {<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">type</span>: <span class="code-string">"Point"</span>,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">coordinates</span>: [<span class="code-number">105.8342</span>, <span class="code-number">21.0278</span>]  <span class="code-comment">// [lng, lat]</span><br>
          &nbsp;&nbsp;}<br>
          }
        </div>

        <div class="code-block">
          <span class="code-comment">// $near query - t√¨m g·∫ßn nh·∫•t</span><br>
          db.places.<span class="code-method">find</span>({<br>
          &nbsp;&nbsp;<span class="code-prop">location</span>: {<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">$near</span>: {<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">$geometry</span>: {<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">type</span>: <span class="code-string">"Point"</span>,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">coordinates</span>: [<span class="code-number">105.8342</span>, <span class="code-number">21.0278</span>]<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">$maxDistance</span>: <span class="code-number">5000</span>  <span class="code-comment">// 5km</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;}<br>
          &nbsp;&nbsp;}<br>
          })
        </div>

        <div class="code-block">
          <span class="code-comment">// $geoWithin - trong v√πng</span><br>
          db.places.<span class="code-method">find</span>({<br>
          &nbsp;&nbsp;<span class="code-prop">location</span>: {<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">$geoWithin</span>: {<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">$centerSphere</span>: [[<span class="code-number">105.8342</span>, <span class="code-number">21.0278</span>], <span class="code-number">10</span>/<span class="code-number">6378.1</span>]<br>
          &nbsp;&nbsp;&nbsp;&nbsp;}<br>
          &nbsp;&nbsp;}<br>
          })
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">#Ô∏è‚É£</span>
          <span class="card-title">Hashed Index</span>
        </div>
        <div class="highlight">
          Index d√πng hash function - t·ªët cho sharding
        </div>
        
        <div class="code-block">
          <span class="code-comment">// T·∫°o hashed index</span><br>
          db.users.<span class="code-method">createIndex</span>({ <span class="code-prop">userId</span>: <span class="code-string">"hashed"</span> })
        </div>

        <div class="code-block">
          <span class="code-comment">// Equality queries</span><br>
          db.users.<span class="code-method">find</span>({ <span class="code-prop">userId</span>: <span class="code-string">"user123"</span> })
        </div>

        <div class="info-box">
          üí° <strong>Use cases:</strong><br>
          ‚Ä¢ Shard key cho sharded cluster<br>
          ‚Ä¢ Equality queries tr√™n high-cardinality fields<br>
          ‚Ä¢ Distribute data evenly
        </div>

        <div class="warning-box">
          ‚ö†Ô∏è <strong>KH√îNG h·ªó tr·ª£:</strong><br>
          ‚Ä¢ Range queries ($gt, $lt...)<br>
          ‚Ä¢ Multi-key (arrays)<br>
          ‚Ä¢ Floating point numbers
        </div>

        <div class="code-block">
          <span class="code-comment">// Compound hashed index (MongoDB 4.4+)</span><br>
          db.users.<span class="code-method">createIndex</span>({<br>
          &nbsp;&nbsp;<span class="code-prop">userId</span>: <span class="code-string">"hashed"</span>,<br>
          &nbsp;&nbsp;<span class="code-prop">status</span>: <span class="code-number">1</span><br>
          })
        </div>
      </div>
    </div>

    <!-- Wildcard Index & Index Management -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üåü</span>
          <span class="card-title">Wildcard Index</span>
        </div>
        <div class="highlight">
          Index cho dynamic/unknown fields
        </div>
        
        <div class="code-block">
          <span class="code-comment">// Index t·∫•t c·∫£ fields</span><br>
          db.products.<span class="code-method">createIndex</span>({ <span class="code-string">"$**"</span>: <span class="code-number">1</span> })
        </div>

        <div class="code-block">
          <span class="code-comment">// Index specific path</span><br>
          db.products.<span class="code-method">createIndex</span>({ <span class="code-string">"attributes.$**"</span>: <span class="code-number">1</span> })
        </div>

        <div class="code-block">
          <span class="code-comment">// V·ªõi wildcardProjection</span><br>
          db.products.<span class="code-method">createIndex</span>(<br>
          &nbsp;&nbsp;{ <span class="code-string">"$**"</span>: <span class="code-number">1</span> },<br>
          &nbsp;&nbsp;{<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">wildcardProjection</span>: {<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">name</span>: <span class="code-number">1</span>,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">price</span>: <span class="code-number">1</span>,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">_id</span>: <span class="code-number">0</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;}<br>
          &nbsp;&nbsp;}<br>
          )
        </div>

        <div class="warning-box">
          ‚ö†Ô∏è Wildcard index c√≥ overhead l·ªõn - ch·ªâ d√πng khi th·ª±c s·ª± c·∫ßn
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üîß</span>
          <span class="card-title">Index Management</span>
        </div>
        
        <div class="section-title">Xem Indexes</div>
        <div class="code-block">
          <span class="code-comment">// Li·ªát k√™ t·∫•t c·∫£ indexes</span><br>
          db.users.<span class="code-method">getIndexes</span>()<br><br>
          
          <span class="code-comment">// Index stats</span><br>
          db.users.<span class="code-method">stats</span>().<span class="code-prop">indexSizes</span>
        </div>

        <div class="section-title">X√≥a Index</div>
        <div class="code-block">
          <span class="code-comment">// X√≥a index theo name</span><br>
          db.users.<span class="code-method">dropIndex</span>(<span class="code-string">"email_1"</span>)<br><br>
          
          <span class="code-comment">// X√≥a index theo specification</span><br>
          db.users.<span class="code-method">dropIndex</span>({ <span class="code-prop">email</span>: <span class="code-number">1</span> })<br><br>
          
          <span class="code-comment">// X√≥a t·∫•t c·∫£ indexes (tr·ª´ _id)</span><br>
          db.users.<span class="code-method">dropIndexes</span>()
        </div>

        <div class="section-title">Rebuild Index</div>
        <div class="code-block">
          <span class="code-comment">// Rebuild t·∫•t c·∫£ indexes</span><br>
          db.users.<span class="code-method">reIndex</span>()
        </div>

        <div class="warning-box">
          ‚ö†Ô∏è <strong>reIndex()</strong> block collection - d√πng c·∫©n th·∫≠n trong production
        </div>
      </div>
    </div>

    <!-- Explain & Performance -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">üìà</span>
          <span class="card-title">explain() - Analyze Queries</span>
        </div>
        <div class="highlight">
          Ph√¢n t√≠ch query execution plan
        </div>
        
        <div class="code-block">
          <span class="code-comment">// executionStats mode</span><br>
          db.users.<span class="code-method">find</span>({ <span class="code-prop">age</span>: { <span class="code-keyword">$gt</span>: <span class="code-number">25</span> } })<br>
          &nbsp;&nbsp;.<span class="code-method">explain</span>(<span class="code-string">"executionStats"</span>)
        </div>

        <div class="example-box">
          <div class="example-title">Key metrics to check:</div>
          <div class="code-block">
            {<br>
            &nbsp;&nbsp;<span class="code-prop">executionStats</span>: {<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">executionTimeMillis</span>: <span class="code-number">5</span>,<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">totalDocsExamined</span>: <span class="code-number">100</span>,<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">totalKeysExamined</span>: <span class="code-number">100</span>,<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">nReturned</span>: <span class="code-number">50</span><br>
            &nbsp;&nbsp;},<br>
            &nbsp;&nbsp;<span class="code-prop">winningPlan</span>: {<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">stage</span>: <span class="code-string">"IXSCAN"</span>,  <span class="code-comment">// D√πng index ‚úì</span><br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-prop">indexName</span>: <span class="code-string">"age_1"</span><br>
            &nbsp;&nbsp;}<br>
            }
          </div>
        </div>

        <div class="performance-box">
          <div class="perf-good">
            <strong style="color: #81c784;">‚úÖ Good Signs:</strong><br>
            ‚Ä¢ stage: "IXSCAN"<br>
            ‚Ä¢ totalKeysExamined ‚âà nReturned<br>
            ‚Ä¢ executionTimeMillis < 100ms
          </div>
          <div class="perf-bad">
            <strong style="color: #e57373;">‚ùå Bad Signs:</strong><br>
            ‚Ä¢ stage: "COLLSCAN"<br>
            ‚Ä¢ totalDocsExamined >> nReturned<br>
            ‚Ä¢ executionTimeMillis > 1000ms
          </div>
        </div>

        <div class="code-block">
          <span class="code-comment">// allPlansExecution - xem t·∫•t c·∫£ plans</span><br>
          db.users.<span class="code-method">find</span>({...}).<span class="code-method">explain</span>(<span class="code-string">"allPlansExecution"</span>)
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üéØ</span>
          <span class="card-title">Index Best Practices</span>
        </div>
        
        <div class="section-title">‚úÖ DO's</div>
        <div class="list-item">Index fields d√πng trong queries th∆∞·ªùng xuy√™n</div>
        <div class="list-item">D√πng compound index thay v√¨ nhi·ªÅu single indexes</div>
        <div class="list-item">ƒê·∫∑t equality fields tr∆∞·ªõc sort/range fields (ESR)</div>
        <div class="list-item">D√πng covered queries khi c√≥ th·ªÉ</div>
        <div class="list-item">Monitor index usage v·ªõi $indexStats</div>
        <div class="list-item">X√≥a unused indexes</div>

        <div class="section-title">‚ùå DON'Ts</div>
        <div class="list-item">T·∫°o qu√° nhi·ªÅu indexes (m·ªói index t·ªën RAM & write performance)</div>
        <div class="list-item">Index low-cardinality fields (√≠t unique values)</div>
        <div class="list-item">Index fields hi·∫øm khi query</div>
        <div class="list-item">Duplicate indexes</div>

        <div class="code-block">
          <span class="code-comment">// Check index usage</span><br>
          db.users.<span class="code-method">aggregate</span>([<br>
          &nbsp;&nbsp;{ <span class="code-keyword">$indexStats</span>: {} }<br>
          ])
        </div>

        <div class="tip-box">
          ‚úÖ <strong>Rule of thumb:</strong> S·ªë indexes ‚âà s·ªë query patterns th∆∞·ªùng xuy√™n
        </div>
      </div>
    </div>

    <!-- Covered Queries & Index Intersection -->
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">‚ö°</span>
          <span class="card-title">Covered Queries</span>
        </div>
        <div class="highlight">
          Query ch·ªâ c·∫ßn ƒë·ªçc index, kh√¥ng c·∫ßn ƒë·ªçc documents
        </div>
        
        <div class="code-block">
          <span class="code-comment">// T·∫°o compound index</span><br>
          db.users.<span class="code-method">createIndex</span>({<br>
          &nbsp;&nbsp;<span class="code-prop">status</span>: <span class="code-number">1</span>,<br>
          &nbsp;&nbsp;<span class="code-prop">age</span>: <span class="code-number">1</span>,<br>
          &nbsp;&nbsp;<span class="code-prop">name</span>: <span class="code-number">1</span><br>
          })
        </div>

        <div class="code-block">
          <span class="code-comment">// Covered query - si√™u nhanh!</span><br>
          db.users.<span class="code-method">find</span>(<br>
          &nbsp;&nbsp;{ <span class="code-prop">status</span>: <span class="code-string">"active"</span>, <span class="code-prop">age</span>: { <span class="code-keyword">$gt</span>: <span class="code-number">25</span> } },<br>
          &nbsp;&nbsp;{ <span class="code-prop">name</span>: <span class="code-number">1</span>, <span class="code-prop">_id</span>: <span class="code-number">0</span> }  <span class="code-comment">// Ph·∫£i exclude _id</span><br>
          )
        </div>

        <div class="code-block">
          <span class="code-comment">// Ki·ªÉm tra covered query trong explain</span><br>
          db.users.<span class="code-method">find</span>({...}, {name: <span class="code-number">1</span>, _id: <span class="code-number">0</span>})<br>
          &nbsp;&nbsp;.<span class="code-method">explain</span>(<span class="code-string">"executionStats"</span>)<br><br>
          
          <span class="code-comment">// totalDocsExamined: 0 ‚Üí Covered! ‚úì</span>
        </div>

        <div class="tip-box">
          ‚úÖ <strong>Requirements cho covered query:</strong><br>
          ‚Ä¢ T·∫•t c·∫£ query fields trong index<br>
          ‚Ä¢ T·∫•t c·∫£ projection fields trong index<br>
          ‚Ä¢ Ph·∫£i exclude _id (ho·∫∑c _id trong index)
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-icon">üîÄ</span>
          <span class="card-title">Index Intersection</span>
        </div>
        <div class="highlight">
          MongoDB c√≥ th·ªÉ d√πng nhi·ªÅu indexes cho m·ªôt query
        </div>
        
        <div class="code-block">
          <span class="code-comment">// T·∫°o 2 single indexes</span><br>
          db.users.<span class="code-method">createIndex</span>({ <span class="code-prop">status</span>: <span class="code-number">1</span> })<br>
          db.users.<span class="code-method">createIndex</span>({ <span class="code-prop">age</span>: <span class="code-number">1</span> })
        </div>

        <div class="code-block">
          <span class="code-comment">// Query c√≥ th·ªÉ d√πng c·∫£ 2 indexes</span><br>
          db.users.<span class="code-method">find</span>({<br>
          &nbsp;&nbsp;<span class="code-prop">status</span>: <span class="code-string">"active"</span>,<br>
          &nbsp;&nbsp;<span class="code-prop">age</span>: { <span class="code-keyword">$gt</span>: <span class="code-number">25</span> }<br>
          })
        </div>

        <div class="example-box">
          <div class="example-title">Trong explain():</div>
          <div class="code-block">
            {<br>
            &nbsp;&nbsp;<span class="code-prop">stage</span>: <span class="code-string">"AND_SORTED"</span>,<br>
            &nbsp;&nbsp;<span class="code-prop">inputStages</span>: [<br>
            &nbsp;&nbsp;&nbsp;&nbsp;{ <span class="code-prop">stage</span>: <span class="code-string">"IXSCAN"</span>, <span class="code-prop">indexName</span>: <span class="code-string">"status_1"</span> },<br>
            &nbsp;&nbsp;&nbsp;&nbsp;{ <span class="code-prop">stage</span>: <span class="code-string">"IXSCAN"</span>, <span class="code-prop">indexName</span>: <span class="code-string">"age_1"</span> }<br>
            &nbsp;&nbsp;]<br>
            }
          </div>
        </div>

        <div class="warning-box">
          ‚ö†Ô∏è Index intersection th∆∞·ªùng <strong>ch·∫≠m h∆°n</strong> compound index<br>
          ‚Üí N√™n t·∫°o compound index cho query patterns th∆∞·ªùng xuy√™n
        </div>
      </div>
    </div>

    <!-- Quick Reference -->
    <div class="grid">
      <div class="card full-width">
        <div class="card-header">
          <span class="card-icon">üìö</span>
          <span class="card-title">Quick Reference - Index Commands</span>
        </div>
        <table class="comparison-table">
          <tr>
            <th>Command</th>
            <th>Syntax</th>
            <th>M√¥ t·∫£</th>
          </tr>
          <tr>
            <td>Create Index</td>
            <td><code>db.col.createIndex({field: 1})</code></td>
            <td>T·∫°o index m·ªõi</td>
          </tr>
          <tr>
            <td>List Indexes</td>
            <td><code>db.col.getIndexes()</code></td>
            <td>Xem t·∫•t c·∫£ indexes</td>
          </tr>
          <tr>
            <td>Drop Index</td>
            <td><code>db.col.dropIndex("name")</code></td>
            <td>X√≥a index</td>
          </tr>
          <tr>
            <td>Drop All</td>
            <td><code>db.col.dropIndexes()</code></td>
            <td>X√≥a t·∫•t c·∫£ (tr·ª´ _id)</td>
          </tr>
          <tr>
            <td>Rebuild</td>
            <td><code>db.col.reIndex()</code></td>
            <td>Rebuild indexes</td>
          </tr>
          <tr>
            <td>Explain</td>
            <td><code>db.col.find().explain()</code></td>
            <td>Analyze query plan</td>
          </tr>
          <tr>
            <td>Index Stats</td>
            <td><code>db.col.aggregate([{$indexStats:{}}])</code></td>
            <td>Index usage statistics</td>
          </tr>
          <tr>
            <td>Unique</td>
            <td><code>createIndex({f:1}, {unique:true})</code></td>
            <td>Unique constraint</td>
          </tr>
          <tr>
            <td>Sparse</td>
            <td><code>createIndex({f:1}, {sparse:true})</code></td>
            <td>Ch·ªâ index docs c√≥ field</td>
          </tr>
          <tr>
            <td>Partial</td>
            <td><code>createIndex({f:1}, {partialFilterExpression:{...}})</code></td>
            <td>Index v·ªõi ƒëi·ªÅu ki·ªán</td>
          </tr>
          <tr>
            <td>TTL</td>
            <td><code>createIndex({f:1}, {expireAfterSeconds:3600})</code></td>
            <td>Auto-delete documents</td>
          </tr>
        </table>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <p>üìö MongoDB Cheat Sheet Series | Part 8 of 16</p>
      <p>Created with Monica AI | December 2024</p>
    </div>
  </div>
</body>
</html>